var Setup=function(){},Draw=function(){},Update=function(){},onMouseUp=function(){},onMouseDown=function(){},onMouseMove=function(){},onMouseDrag=function(){},onKeyDown=function(){},onKeyUp=function(){};
(function(){var J="undefined"!==typeof global&&null!==global?global:this,m={body:document.body,html:document.documentElement,FTime:{},FIO:{},F3D:{}};paper.install(window);PaperScope.inject({enumerable:!0,println:function(f){console.log(f);console.log("\n")},boolToInt:function(f){return f?1:0},numToBool:function(f){return 0!==f?!0:!1},getType:function(f){return f instanceof Point?"Point":f instanceof Size?"Size":f instanceof Rectangle?"Rectangle":f instanceof Group?"Group":f instanceof Raster?"Raster":
f instanceof PlacedSymbol?"PlacedSymbol":f instanceof Path?"Path":f instanceof CompoundPath?"CompoundPath":f instanceof Symbol?"Symbol":f instanceof TextItem?"TextItem":Object.prototype.toString.call(f).split(/\W/)[2]},findByName:function(f,a){for(var b,c=0;c<f.length;c++){var d=f[c];d.name===a&&(b=d)}return b},findById:function(f,a){for(var b,c=0;c<f.length;c++){var d=f[c];d.id===a&&(b=d)}return b},forEach:function(f,a){for(var b=0,c=f.length;b<c;b++)if(!1===a(f[b],b))return!1;return!0},clear:function(f,
a){var b,c,d;2===arguments.length?(b=f,c=a):1===arguments.length&&(b=void 0,c=f);for(var e=0;e<projects.length;e++){if(void 0!==b)try{d=projects[e].layers[b],d.removeChildren()}catch(g){}else projects[e].clear(),d=new Layer;c&&c(d)}}});PaperScope.inject({enumerable:!0,random:function(f,a){void 0===a&&(a=f,f=0);return f+Math.random()*(a-f)},randomInt:function(f,a){return parseInt(paper.random(f,a))},randomBias:function(f,a,b){var c=[90,9,4,2.33,1.5,1,.66,.43,.25,.11,.01];b=10*Math.max(0,Math.min(b,
1));var d=parseInt(Math.floor(b)),e=c[d];10>b&&(e+=(c[d+1]-e)*(b-d));return Math.pow(Math.random(),e)*(a-f)+f},clamp:function(f,a,b){return f<a?a:f>b?b:f},normalize:function(f,a,b){return(f-a)/(b-a)},map:function(f,a,b,c,d){return c+(f-a)/(b-a)*(d-c)},round:function(f,a){var b=Math.pow(10,a);return Math.round(f*b)/b},roundMultiple:function(f,a){return Math.floor(f/a)*a+a},snap:function(f,a,b){b=b||Math.round;return paper.round(a*b(f/a),2)},interpolate:function(f,a,b){return f+(a-f)*b},divisor:function(f){for(var a=
[],b=[],c=Math.floor(Math.sqrt(f)),d=1;d<=c;d++)0===f%d&&(a.push(d),d*d!==f&&b.push(f/d));b.reverse();return a.concat(b)},degrees:function(f){return 180/Math.PI*f},radians:function(f){return Math.PI/180*f},sec:function(f){return 1/Math.cos(f)},cosec:function(f){return 1/Math.sin(f)},slope:function(f,a){var b=a*Math.cos(paper.radians(f)),c=a*Math.sin(paper.radians(f));return new Point(b,c)},slopeRatio:function(f,a){return(a.y-f.y)/(a.x-f.x)},slopeAngle:function(f){return paper.degrees(Math.atan(f.x/
f.y))},sq:function(f){return f*f},getCommonTangents:function(f,a){var b=a.position.x-f.position.x,c=a.position.y-f.position.y,d=Math.sqrt(f.bounds.size.getArea()),e=Math.sqrt(a.bounds.size.getArea()),d=d/2,e=e/2,g=f.position.getDistance(a.position);if(!(g<=Math.abs(e-d))){var b=Math.atan2(c,b),l=Math.acos((d-e)/g),g=new Point(f.position.x+d*Math.cos(b+l),f.position.y+d*Math.sin(b+l)),c=new Point(a.position.x+e*Math.cos(b+l),a.position.y+e*Math.sin(b+l)),d=new Point(f.position.x+d*Math.cos(b-l),f.position.y+
d*Math.sin(b-l)),e=new Point(a.position.x+e*Math.cos(b-l),a.position.y+e*Math.sin(b-l));return[g,c,e,d]}},reverser:function(f,a,b){f=f||0;a=a||100;b=b||1;var c=0===f&&100===a?100:1,d=!1,e=0;return function(){e=d?e+b:e-b;e<f&&!d?d=!0:e>a&&d&&(d=!1);return e/c}}});paper.Color.inject({data:null,toInt:function(){var f=this.red,f=f<<8|this.green;return f=f<<8|this.blue},toHex:function(){function f(a){a=a.toString(16);return 1===a.length?"0"+a:a}return"#"+f(255*this.red)+f(255*this.green)+f(255*this.blue)},
desaturate:function(f){var a=new Color(this);a.saturation=paper.clamp(this.saturation-this.saturation*f,0,1);a.setType(this.type);return a},saturate:function(f){var a=new Color(this);a.saturation=paper.clamp(this.saturation+this.saturation*f,0,1);a.setType(this.type);return a},darken:function(f){var a=new Color(this);a.lightness=paper.clamp(this.lightness-this.lightness*f,0,1);a.setType(this.type);return a},dim:function(f){var a=new Color(this);a.brightness=paper.clamp(this.brightness-this.brightness*
f,0,1);a.setType(this.type);return a},lighten:function(f){var a=new Color(this);a.lightness=paper.clamp(this.lightness+this.lightness*f,0,1);a.setType(this.type);return a},brighten:function(f){var a=new Color(this);a.saturation=paper.clamp(this.saturation-this.saturation*f,0,1);a.brightness=paper.clamp(this.brightness+this.brightness*f,0,1);a.setType(this.type);return a},contrast:function(f){var a=new Color(this);a.setType(this.type);return.5>a.lightness?a.darken(f):a.lighten(f)},invert:function(){var f=
new Color(this);f.hue+=180;f.setType(this.type);return f},rotate:function(f){var a=new Color(this);a.hue+=f;a.setType(this.type);return a},interpolate:function(f,a,b){var c=new Color(this),d,e;if("number"===typeof a)for(d=f.getComponents(),e=0;e<c._components.length;e++)c._components[e]=paper.interpolate(c._components[e],d[e],a);else for(f=f.getComponents(),d=a.getComponents(),e=0;e<c._components.length;e++)c._components[e]=paper.interpolate(f[e],d[e],b);c.setType(this.type);return c},statics:{random:function(f){var a;
if("String"===paper.getType(f))return a=f.substring(1),new Color.random(parseInt(a.slice(0,2),16)/255,parseInt(a.slice(2,4),16)/255,parseInt(a.slice(4,6),16)/255);if("Object"===paper.getType(f)){a={};for(var b in f)"Array"===paper.getType(f[b])?a[b]=paper.random(f[b][0],f[b][1]):a[b]=paper.random(0,f[b])}else{a=[];b=0<arguments.length?arguments.length:4;for(var c=0;c<b;c++)"Array"===paper.getType(arguments[c])?a.push(paper.random(arguments[c][0],arguments[c][1])):"Number"===paper.getType(arguments[c])?
a.push(paper.random(0,arguments[c])):a.push(paper.random(1))}b=new Color(a);b.data="hex"===f?a:null;b.alpha=1;b.setType(1<a[0]?"hsb":"rgb");return b},integer:function(f){return new Color(f>>16&255,f>>8&255,f&255)},bytes:function(f,a,b,c){return 4===arguments.length?new Color(f/255,a/255||f/255,b/255||f/255,c/255||1):new Color(f/255,a/255||f/255,b/255||f/255)}}});PaperScope.inject({enumerable:!0,PIXEL_TO_MM:.352777778,MM_TO_PIXEL:2.83464567,POINT_TO_MM:.352777778,MM_TO_POINT:2.83464567,PIXEL_TO_CM:.0352777778,
CM_TO_PIXEL:28.3464567,POINT_TO_CM:.0352777778,CM_TO_POINT:28.3464567,PIXEL_TO_INCH:.0138888889,INCH_TO_PIXEL:72,POINT_TO_INCH:.0138888889,INCH_TO_POINT:72,PIXEL_TO_PICA:.0833333333,PICA_TO_PIXEL:12,POINT_TO_PICA:.0833333333,PICA_TO_POINT:12});paper.Item.inject({enumerable:!0,_prevAngle:0,_prevPosition:{x:0,y:0},_prevHor:1,_prevVer:1,snap:function(f,a){this.position.snap(f,a)},getDistanceToCenter:function(){if(void 0!==this._position){var f=this._position.x-view.bounds.center.x,a=this._position.y-
view.bounds.center.y;return f*f+a*a+1}},toGroup:function(){return"CompoundPath"===paper.getType(this)?new Group(this.children):this},setRotation:function(f,a){a=a||this.point;this.rotate(-(f-this._prevAngle),a);this._prevAngle=f;return this},setTranslation:function(f){f=new Point(f);this.translate(new Point(f.x-this._prevPosition.x,f.y-this._prevPosition.y));this._prevPosition=f;return this},setScaling:function(f,a,b){var c,d,e;if(0!==arguments.length)return 2===arguments.length&&(c=f,a instanceof
Point?(d=c,e=a):(d=a,e=this.position)),3===arguments.length&&(c=f,d=a,e=b),this.scale(1+(c-this._prevHor),1+(d-this._prevVer),e),this._prevHor=c,this._prevVer=d,this}});paper.Path.inject({getCentroid:function(){for(var f=new Point(0,0),a=0,b,c=[],d=0;d<this._segments.length-1;++d)c[0]=this._segments[d].point,c[1]=this._segments[d+1].point,b=c[0].x*c[1].y-c[1].x*c[0].y,a+=b,f.x+=(c[0].x+c[1].x)*b,f.y+=(c[0].y+c[1].y)*b;c[0]=this._segments[d].point;c[1]=this._segments[0].point;b=c[0].x*c[1].y-c[1].x*
c[0].y;f.x+=(c[0].x+c[1].x)*b;f.y+=(c[0].y+c[1].y)*b;a=.5*(a+b);f.x/=6*a;f.y/=6*a;return f},getCircumcenter:function(){for(var f=this._segments.length,a=[],b=[],c,d,e,g=0;g<f;g++){c=g+1>=f?0:g+1;d=g+2>=f?1:g+2;e=this._segments[g].point;c=this._segments[c].point;d=this._segments[d].point;var l=c.x-e.x,h=c.y-e.y,k=d.x-e.x,p=d.y-e.y,t=l*(e.x+c.x)+h*(e.y+c.y),n=k*(e.x+d.x)+p*(e.y+d.y),r=2*(l*(d.y-c.y)-h*(d.x-c.x));Math.abs(r)<Numerical.EPSILON?(l=[e.x,c.x,d.x],e=[e.y,c.y,d.y],c=l.min(),d=e.min(),h=l.max(),
k=e.max(),e=new Point((l[c]+l[h])/2,(e[d]+e[k])/2)):e=new Point((p*t-h*n)/r,(l*n-k*t)/r);a.push(e.x);b.push(e.y)}return new Point(a.median(),b.median())},getCircumcircle:function(){function f(b){var d=b.point;b=d.x-a.getCircumcenter().x;d=d.y-a.getCircumcenter().y;return Math.sqrt(b*b+d*d)}var a=this,b=0,b=this._segments.slice();b.sort(function(a,b){return f(a)-f(b)});b=f(b[b.length-1])+f(b[b.length-2]);b/=2;return Shape.Circle(a.getCircumcenter(),b)},getIncircle:function(){for(var f=Number.MAX_VALUE,
a=0;a<this._segments.length;a++){var b=this._segments[a].point;b.getDistance(this.getCentroid())<f&&(f=b.getDistance(this.getCentroid()))}return Shape.Circle(this.getCentroid(),f)},statics:new function(){return{FArrow:function(f,a,b){var c=new Path.Line(f,a);b=b||new Size(.381924*f.getDistance(a),.381924*f.getDistance(a));a=Math.atan2(f.x-a.x,a.y-f.y);var d=[];d[0]=new Path.Line(new Point(0,0),new Point(-b.width,-b.height));d[1]=new Path.Line(new Point(0,0),new Point(b.width,-b.height));for(b=0;b<
d.length;b++)d[b].rotate(180+paper.degrees(a),new Point(0,0)),d[b].translate(f);f=new Group([c,d[0],d[1]]);f.name="arrow";return f},FBubble:function(f,a,b,c){var d=new Path;d.name="bubble";b=b||defaultFBubbleTagSize;10>a.width&&(a.width=10,b=new Size(10,10));c=c||"RANDOM";d.add(new Point(0,0));var e=180,e=new Point(a.height/2+Math.cos(paper.radians(e))*a.height,a.height/2+Math.sin(paper.radians(e))*a.height);d.arcTo(e,new Point(0,a.height));e=paper.randomInt(0,a.width-b.width);d.add(new Point(e,a.height));
c="LEFT"===c?e:"CENTER"===c?e+b.width/2:"RIGHT"===c?e+b.width:paper.randomInt(e,e+b.width);d.add(new Point(c,a.height+b.height));d.add(new Point(e+b.width,a.height));d.add(new Point(a.width,a.height));e=0;new Point(a.height/2+Math.cos(paper.radians(e))*(a.height/2),a.height/2+Math.sin(paper.radians(e))*(a.height/2));d.arcTo(new Point(a.width,0),!1);d.closed=!0;d.position=new Point(f.x,f.y+b.height/2);return d},FChain:function(f,a,b,c){"Point"===paper.getType(f)?(f=new Path.Circle(f,a),c=new Path.Circle(b,
c)):c=a;a=paper.getCommonTangents(f,c);b=new Path;if(null!==a){b.name="chain";b.add(a[0]);b.add(a[1]);angle=c.position.x>f.position.x?0:c.position.y<f.position.y?-90:c.position.y>f.position.y?90:180;var d=new Point(c.position.x+Math.cos(paper.radians(angle))*(c.bounds.width/2),c.position.y+Math.sin(paper.radians(angle))*(c.bounds.height/2));b.arcTo(d,a[2]);b.add(a[2]);b.add(a[3]);angle=f.position.x>c.position.x?0:f.position.y<c.position.y?-90:f.position.y>c.position.y?90:180;f=new Point(f.position.x+
Math.cos(paper.radians(angle))*(f.bounds.width/2),f.position.y+Math.sin(paper.radians(angle))*(f.bounds.height/2));b.arcTo(f,a[0]);b.closed=!0}return b},FCross:function(f,a,b,c){b=b||1;c=c||"LINE";var d,e;"LINE"===c?(d=new Path.Line(f.x+a.width,f.y-a.height,f.x-a.width,f.y+a.height),d.strokeWidth=b,e=new Path.Line(f.x+a.width,f.y+a.height,f.x-a.width,f.y-a.height),e.strokeWidth=b):"SHARP"===c&&(d=new Path,d.add(new Point(f.x+a.width,f.y-a.height)),d.add(new Point(f.x+a.width,f.y-a.height+b/2)),d.add(new Point(f.x-
a.width+b/2,f.y+a.height)),d.add(new Point(f.x-a.width,f.y+a.height)),d.add(new Point(f.x-a.width,f.y+a.height-b/2)),d.add(new Point(f.x+a.width-b/2,f.y-a.height)),d.closed=!0,e=new Path,e.add(new Point(f.x-a.width,f.y-a.height)),e.add(new Point(f.x-a.width+b/2,f.y-a.height)),e.add(new Point(f.x+a.width,f.y+a.height-b/2)),e.add(new Point(f.x+a.width,f.y+a.height)),e.add(new Point(f.x+a.width-b/2,f.y+a.height)),e.add(new Point(f.x-a.width,f.y-a.height+b/2)),e.closed=!0);f=new Group([d,e]);f.name="cross";
return f},FDrip:function(f,a){var b=new Path;b.name="drop";b.add(new Segment(new Point(-.01,.01),new Point(0,-.0055078),new Point(0,.643042)));b.add(new Segment(new Point(-.65,1.6381104),new Point(0,-.6109619),new Point(0,.3694434)));b.add(new Segment(new Point(0,2.31),new Point(-.3578369,0),new Point(.3578369,0)));b.add(new Segment(new Point(.65,1.6381104),new Point(0,.3694434),new Point(0,-.6109619)));b.add(new Segment(new Point(.01,.01),new Point(0,.643042),new Point(0,-.0055078)));b.add(new Segment(new Point(0,
-0),new Point(.0055078,0),new Point(-.0055078,0)));b.closed=!0;b.position=f;"Size"===typeof a?b.scale(a.width,a.height):b.scale(a);return b},FTriangle:function(f,a,b){var c;if(3===arguments.length)c=new Path,c.add(f),c.add(a),c.add(b);else if(2===arguments.length)c=new Path.RegularPolygon(f,3,a);else return;c.closed=!0;c.name="triangle";return c}}}});paper.Point.inject({name:null,data:{},snap:function(f,a){a=void 0!==a?a:{grid:!0,isometric:!1};f="Size"===f.type?f:new Size(f,f);var b,c;!0===a.isometric?
(b=Math.round(this.y/(16*f.height)-this.x/(32*f.width)),c=Math.round(this.y/(16*f.height)+this.x/(16*f.width)),this.x=(c-b)/2*32*f.width,this.y=(c+b)/2*16*f.height):(b=Math.round(this.y/f.height-this.x/f.width),c=Math.round(this.y/f.height+this.x/f.width),this.x=(c-b)/2*f.width,this.y=(c+b)/2*f.height);return this},interpolateTo:function(f,a){return new Point(this.x+(f.x-this.x)*a,this.y+(f.y-this.y)*a)},invertX:function(){this.x=view.bounds.width-this.x;return this},invertY:function(){this.y=view.bounds.height-
this.y;return this},getDistanceToCenter:function(){return this.getDistance(view.bounds.center)},getMid:function(f){return new Point((this.x+f.x)/2,(this.y+f.y)/2)},getPerpendicularBisector:function(f,a){var b=new Path.Line(this,f);b.setRotation(90);a=a||1;"fit"===a&&(a=view.size.getArea()/b.bounds.size.getArea());b.setScaling(a,a);var c={start:b.segments[0].point,mid:b.position,end:b.segments[1].point};b.remove();return c},getSlope:function(f){return paper.slopeRatio(this,f)},getHeading:function(){return-1*
Math.atan2(-this.y,this.x)},getAngle:function(f){f=f||new Point(0,0);return Math.atan2(f.y-this.y,f.x-this.x)},norm:function(f,a){this.x=paper.normalize(this.x,f.x,a.x);this.y=paper.normalize(this.y,f.y,a.y);return this},magSq:function(){return this.x*this.x+this.y*this.y},statics:{interpolateTo:function(f,a,b){return f.interpolateTo(a,b)},invertX:function(f){f=new Point(f);return f.invertX()},invertY:function(f){f=new Point(f);return f.invertY()},random:function(f,a){var b="array"===typeof f?paper.random(f[0],
f[1]):paper.random(f),c="array"===typeof f?paper.random(a[0],a[1]):paper.random(a);return new Point(b,c)}}});paper.Size.inject({getArea:function(){return this.width*this.height},getCircumarea:function(){var f=this.getCircumradius();return Math.PI*f*f},getIncirclearea:function(){var f=this.getIncircleradius();return Math.PI*f*f},getCircumradius:function(){var f=this.width,a=this.height;return Math.sqrt(f*f+a*a)/2},getIncircleradius:function(){return this.width<this.height?this.width/2:this.height/
2},getSlopeAngle:function(){return Math.atan(this.width/this.height)}});paper.TextItem.inject({trimToFit:function(){this.content=this.visibleRange.content.trim();return this}});Base.extend({_class:"Pattern",initialize:function a(b){this._id=a._id=(a._id||0)+1;this._path||this.setPath(b.path||null);this._min||this.setMin(b.min||0);this._max||this.setMax(b.max||100);this.setDensity(b.density||1);this.setStrokeWidth(b.strokeWidth||null);this.setStrokeColor(b.strokeColor||null);this.setFillColor(b.FillColor||
null)},_serialize:function(a,b){return Base.serialize([this._path,this._min,this._max,this._density,this._strokeWidth,this._strokeColor,this._fillColor],a,!0,b)},_changed:function(){this._owner&&this._owner._changed(65)},setPath:function(a){this._path=a;this._changed()},setMin:function(a){this._min=a;this._changed()},setMax:function(a){this._max=a;this._changed()},setDensity:function(a){this._density=Math.round(this._max*a)<this._min?this._min:Math.round(this._max*a);this._changed()},setStrokeWidth:function(a){this._strokeColor=
a;this._changed()},setStrokeColor:function(a){this._strokeColor=Color.read(arguments);this._strokeColor===a&&(this._strokeColor=a.clone());this._strokeColor._owner=this;this._changed()},setFillColor:function(a){this._fillColor=Color.read(arguments);this._fillColor===a&&(this._fillColor=a.clone());this._fillColor._owner=this;this._changed()}}).inject({statics:new function(){return{FPolkaDot:function(){},FHatch:function(){var a=Base.readNamed(arguments);console.log("FHatch OPTIONS",a);console.log("this._strokeColor",
a.strokeColor);console.log("this._min",a.min);return new Group}}}});m.FTime={FDate:{},FStopwatch:{},FStepper:{},Ease:{}};m.FTime.Ease=function(){return{linear:function(a){return a},inQuad:function(a){return a*a},outQuad:function(a){return a*(2-a)},inOutQuad:function(a){return.5>a?2*a*a:-1+(4-2*a)*a},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*a*a+1},inOutCubic:function(a){return.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},inQuart:function(a){return a*a*a*a},outQuart:function(a){return 1-
--a*a*a*a},inOutQuart:function(a){return.5>a?8*a*a*a*a:1-8*--a*a*a*a},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return 1+--a*a*a*a*a},inOutQuint:function(a){return.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a},inSine:function(a){return-1*Math.cos(Math.PI/2*a)+1},outSine:function(a){return 1*Math.sin(Math.PI/2*a)},inOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 1*Math.pow(2,10*(a-1))},outExpo:function(a){return 1*(-Math.pow(2,-10*a)+1)},inOutExpo:function(a){a/=
.5;return 1>a?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*a)+2)},inCirc:function(a){return-1*(Math.sqrt(1-a*a)-1)},outCirc:function(a){a--;return 1*Math.sqrt(1-a*a)},inOutCirc:function(a){a/=.5;if(1>a)return-.5*(Math.sqrt(1-a*a)-1);a-=2;return.5*(Math.sqrt(1-a*a)+1)},spline:function(a,b){function c(a,b){return 1-3*b+3*a}function d(a,b){return 3*b-6*a}function e(a){return 3*a}function g(a,b,n){return((new c(b,n)*a+new d(b,n))*a+new e(b))*a}function l(a,b,n){return 3*new c(b,n)*a*a+2*new d(b,n)*a+new e(b)}
function h(a){for(var b=a,c=0;4>c;++c){var d=new l(b,k[0],k[2]);if(0===d)break;var e=new g(b,k[0],k[2])-a,b=b-e/d}return b}var k;a instanceof Array?k=a:(a=a.normalize(),b=b.normalize(),k=[a.x,a.y,b.x,b.y]);return{get:function(a){return k[0]===k[1]&&k[2]===k[3]?a:new g(new h(a),k[1],k[3])}}},values:{ease:[.25,.1,.25,1],linear:[0,0,1,1],out:[0,0,.58,1],inOut:[.42,0,.58,1]}}};m.FTime.FDate=function(){var a=new Date,b="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),c=function(a){1===
a.length&&(a="0"+a);return a},d=function(){void 0===a&&(a=new Date);return String(a.getFullYear())},e=function(){void 0===a&&(a=new Date);return String(a.getMonth())},g=function(){void 0===a&&(a=new Date);return String(a.getDate())},l=function(){void 0===a&&(a=new Date);var b=String(a.getHours());return c(b)},h=function(){void 0===a&&(a=new Date);var b=String(a.getMinutes());return c(b)},k=function(){void 0===a&&(a=new Date);var b=String(a.getSeconds());return c(b)},p=function(a,b,c){void 0===b&&
void 0===c&&(a=t(a)[0],b=t(a)[1],c=t(a)[2]);return parseInt(36E5*a+6E4*b+1E3*c)},t=function(a){a=a.split(":");return[a[0],a[1],a[2]]};return{year:d,month:e,day:g,weekday:function(){void 0===a&&(a=new Date);return String(b[a.getDay()])},hour:l,minute:h,second:k,date:function(){return d()+e()+g()},now:function(a){a=a||[!0,!0,!0];var b="";a[0]&&(b+=l());a[0]&&a[1]&&(b+=":");a[1]&&(b+=h());a[1]&&a[2]&&(b+=":");a[2]&&(b+=k());return b},nowMilliseconds:function(){return p(l(),h(),k())},add:function(b,c,
d,e){return a+(24*b+60*c+60*d+1E3*e)},sub:function(b,c,d,e){return a-(24*b+60*c+60*d+1E3*e)},set:function(a,b,c,d){time=new Date;time.setTime(24*a+60*b+60*c+1E3*d);return time},get:function(a,b){var c=b||[!0,!0,!0],d=parseInt(a/1E3%60),e=parseInt(a/1E3/60%60),u=parseInt(a/1E3/60/60%24),t="";c[0]&&(t+=10>u?"0"+u:""+u);c[0]&&c[1]&&(t+=":");c[1]&&(t+=10>e?"0"+e:""+e);c[1]&&c[2]&&(t+=":");c[2]&&(t+=10>d?"0"+d:""+d);return t},toMillsecond:p,toArray:t}};m.FTime.FStepper=function(){function a(a){b=a;b/=
1E3}var b=1E3,c=0,d=0,e=!1,g=!1,l=!1,h=1,k=0,p=function(){g=e=!0;l=!1},t=function(){l=e=!0;g=!1};return{delta:function(){return h},counter:function(){return k},toggle:function(){0===d?(d=1,t()):(d=0,p());return d},update:function(a){e&&(e=!1,c=g?paper.round(a+(1-h)*b,3):paper.round(a+h*b,3),c<=a&&(g?(g=!1,h=1):(l=!1,h=0)));g?(h=paper.round(1-(c-a)/b,3),a===c&&(g=!1,h=1,k++)):l&&(h=paper.round((c-a)/b,3),a===c&&(g=!1,h=0,k++))},stepIn:p,stepOut:t,isIn:function(){return g},isOut:function(){return l},
isDone:function(){if(1>h&&0<h)return!1;if(1<h)return h=1,!0;if(0>h)return h=0,!0},stop:function(){e=g=l=!1},setSeconds:function(b){a(parseInt(1E3*b))},setMillis:a,setDelta:function(a){h=a}}};m.FTime.FStopwatch=function(){var a,b,c=0,d=0,e=function(){0===d?g():l()},g=function(){d=1;b=new Date;b.setTime(b.getTime()-c)},l=function(){d=0;a=new Date;c=a.getTime()-b.getTime()};return{toggle:e,start:g,pause:l,reset:function(){c=d=0},set:function(a,k){c=a;d=k?0:1;b=new Date;b.setTime(b.getTime()-c);e()},
get:function(){1===d&&(a=new Date,c=a.getTime()-b.getTime());return c},isRunning:function(){return 0===d?!0:!1}}};m.FIO={saveLocal:function(a,b){window.localStorage?localStorage.setItem(a,String(b)):console.error("localStorage not supported")},getLocal:function(a){return localStorage.getItem(a)},getLocalInt:function(a){return parseInt(getLocal(a))},getLocalFloat:function(a){return parseFloat(getLocal(a))},getAllLocal:function(){return sessionStorage},deleteLocal:function(a){localStorage.removeItem(a)},
saveSession:function(a,b){window.sessionStorage?sessionStorage.setItem(a,String(b)):console.error("sessionStorage not supported")},getSession:function(a){return sessionStorage.getItem(a)},getSessionInt:function(a){return parseInt(getSession(a))},getSessionFloat:function(a){return parseFloat(getSession(a))},getAllSession:function(){return sessionStorage},deleteSession:function(a){sessionStorage.removeItem(a)},saveCookie:function(a,b,c){var d="";c&&(d=new Date,d.setTime(d.getTime()+864E5*c),d="; expires="+
d.toGMTString());document.cookie=a+"="+b+d+"; path=/"},openCookie:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}},deleteCookie:function(a){saveCookie(a,"",-1)},downloadSVG:function(a,b,c){b='<svg id="svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+(b||view.bounds.width)+" "+(c||view.bounds.height)+'">'+pathGroup.exportSVG({asString:!0});b=btoa(b+
"</svg>");c=document.createElement("svg");c.src="data:image/svg+xml;base64,\n"+b;c.alt=a;try{var d=document.createElement("a");d.download=a;d.href=c.src;d.click();return!0}catch(e){return!1}},saveFile:function(a,b){b=b||"Folio.js_fio_file.file";try{var c=new File(script.file.parent,fname);c.exists()&&c.remove();c.open();c.write(Json.encode(a));c.close();return!0}catch(e){}try{var d=document.createElement("a");d.download=b;d.href=a;d.click();return!0}catch(e){}return!1},openFile:function(a){a=new File(script.file.parent,
a);a.open();var b=Json.decode(a.readAll());a.close();return b},deleteFile:function(a){a=new File(script.file.parent,a);a.exists()&&a.remove()},checkFile:function(a){return(new File(script.file.parent,a)).exists()?!0:!1}};m.FASE=function(a){function b(a){var b,c={},d=[];try{b=new jDataView(a,0,void 0,!1)}catch(e){b=null}(!b||"ASEF"!==b.getString(4)||1>b.getInt16()||0>b.getInt16()||1>b.getInt32())&&console.error("illegal file format, not a ASE color palette file");if(!g(b,c))return l={palette:c,values:d}}
function c(a){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){if(c.response)return b(c.response);console.error("could not load ASE file");return l};c.send(null)}function d(a){var b,c;b=a[0].toString(16);2>b.length&&(b="0"+b);c=a[1].toString(16);2>c.length&&(c="0"+c);a=a[2].toString(16);2>a.length&&(a="0"+a);return"#"+b+c+a}function e(a){for(var b,c="",d=a.getUint16();0<--d;)b=a.getUint16(),c+=String.fromCharCode(b);a.getUint16();return c}function g(a,b){for(var c,
t,n,r,w,q,l;0<=--c;)switch(t=a.getUint16(),t){default:console.error("unknown block type "+t.toString(16)+": corrupt ASE file");return;case 49153:a.getUint32();t=e(a);b.groups||(b.groups=[]);b.groups.push(t={name:t});if(g(a,t))return-1;continue;case 49154:return a.getUint32(),0;case 1:a.getUint32();t=e(a);n=a.getString(4);b.colors||(b.colors=[]);b.colors.push(t={name:t,model:n});switch(n){case "CMYK":r=a.getFloat32();w=a.getFloat32();n=a.getFloat32();q=a.getFloat32();t.cmyk=[r,w,n,q];1<=q?r=q=w=0:
(r=r*(1-q)+q,w=w*(1-q)+q,n=n*(1-q)+q,r=1-r,q=1-w,w=1-n,r=Math.min(255,Math.max(0,Math.round(255*r))),q=Math.min(255,Math.max(0,Math.round(255*q))),w=Math.min(255,Math.max(0,Math.round(255*w))));flattened.push(d(t.html_rgb=[r,q,w]));break;case "RGB ":r=a.getFloat32();q=a.getFloat32();w=a.getFloat32();t.rgb=[r,q,w];r=Math.min(255,Math.max(0,Math.round(255*r)));q=Math.min(255,Math.max(0,Math.round(255*q)));w=Math.min(255,Math.max(0,Math.round(255*w)));flattened.push(d(t.html_rgb=[r,q,w]));break;case "LAB ":n=
a.getFloat32();r=a.getFloat32();w=a.getFloat32();t.lab=[n,r,w];n*=100;n=(n+16)/116;l=r/500+n;w=n-w/200;n=.008856<Math.pow(n,3)?Math.pow(n,3):(n-16/116)/7.787;l=.008856<Math.pow(l,3)?Math.pow(l,3):(l-16/116)/7.787;w=.008856<Math.pow(w,3)?Math.pow(w,3):(w-16/116)/7.787;l*=95.047;n*=100;w*=108.883;l/=100;n/=100;w/=100;r=3.2406*l+-1.5372*n+-.4986*w;q=-.9689*l+1.8758*n+.0415*w;w=.0557*l+-.204*n+1.057*w;r=.0031308<r?1.055*Math.pow(r,1/2.4)-.055:12.92*r;q=.0031308<q?1.055*Math.pow(q,1/2.4)-.055:12.92*q;
w=.0031308<w?1.055*Math.pow(w,1/2.4)-.055:12.92*w;r=Math.min(255,Math.max(0,Math.round(255*r)));q=Math.min(255,Math.max(0,Math.round(255*q)));w=Math.min(255,Math.max(0,Math.round(255*w)));flattened.push(d(t.html_rgb=[r,q,w]));break;case "GRAY":q=a.getFloat32();t.gray=q;q=Math.min(255,Math.max(0,Math.round(255*q)));flattened.push(d(t.html_rgb=[q,q,q]));break;default:return console.error("unknown color model "+n+": corrupt ASE file"),-1}n=a.getUint16();t.color_type=n}return 0}var l={};a&&("string"===
typeof a?c(a):"object"===typeof a&&b(a));return{colors:function(){return l},load:c,loadData:b}};Array.prototype.median=function(){if("Array"===Object.prototype.toString.call(this).split(/\W/)[2])return this.sort(),0===this.length%2?(this[this.length/2-1]+this[this.length/2])/2:this[(this.length-1)/2]};Array.prototype.average=function(){if("Array"===Object.prototype.toString.call(this).split(/\W/)[2]){for(var a=0,b=0;b<this.length,isFinite(this[b]);b++)a+=parseFloat(this[b]);return a/(this.length-
1)}};Array.prototype.merge=function(a){if("Array"===Object.prototype.toString.call(this).split(/\W/)[2])return this.concat(a)};Object.prototype.combine=function(a){for(var b in this)a[b]=void 0!==a[b]?a[b]:this[b];return a};Array.prototype.findIndex=function(a){for(var b,c=this.length-1;0<=c&&(b=this[c],"string"===typeof this[c]&&(b=b.toLowerCase()),"string"===typeof a&&(a=a.toLowerCase()),b!==a);c--);return c};Array.prototype.max=function(a,b){a=void 0!==a?a:0;b=void 0!==b?b:this.length;for(var c=
a,d=a+1;d<b;d++)this[d]>this[c]&&(c=d);return c};Array.prototype.min=function(a,b){a=void 0!==a?a:0;b=void 0!==b?b:this.length;for(var c=a,d=a+1;d<b;d++)this[d]<this[c]&&(c=d);return c};Array.prototype.shuffle=function(){for(var a,b,c=this.length;c;a=parseInt(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);};Array.prototype.unique=function(){var a=[],b=0,c=this.length;a:for(;b<c;b++){for(var d=0,e=a.length;d<e;d++)if(a[d]===this[b])continue a;a[a.length]=this[b]}return a};Array.prototype.removeDuplicates=
function(){if("Array"===Object.prototype.toString.call(this).split(/\W/)[2])return this.reduce(function(a,b){-1===a.indexOf(b)&&a.push(b);return a},[])};Array.prototype.round=function(a){a=Math.pow(10,a);for(var b=0;b<this.length;b++)this[b]=Math.round(this[b]*a)/a;return this};Array.prototype.same=function(a){for(var b=this.concat(),c=[],d=0;d<b.length;++d)for(var e=0;e<a.length;++e)b[d]===a[e]&&c.push(b[d]);return c};m.FCirclePack=function(a,b){function c(){k=!1;p=null}a=a instanceof Group?a.children:
null===a?[]:a;b=b||{};var d=b.iterations||11,e=b.damping||.1,g=b.padding||0,l=b.target||view.center,h={stroke:!0,fill:!0,tolerance:5},k=!1,p;window.addEventListener("onblur",c);window.addEventListener("mouseup",c);window.addEventListener("mouseout",c);window.addEventListener("mousedown",function(a){k=!0;(a=project.hitTest([a.clientX,a.clientY],h))&&a.item&&(p=a.item)});window.addEventListener("mousemove",function(a){k&&p&&(p.position=[a.clientX,a.clientY])});return{update:function(){a=a.sort(FSort.distanceToCenter);
var b=new Point,c,r,k,q,h,u,A;for(A=a.length-1;0<=A;--A){c=a[A];for(var G=A+1;G<a.length;G++)if(r=a[G],A!==G&&(k=r.position.x-c.position.x,q=r.position.y-c.position.y,h=c.bounds.size.width/2+r.bounds.size.width/2+g,u=k*k+q*q,u<h*h-.01)){b.x=k;b.y=q;b=b.normalize(1);b=b.multiply(.5*(h-Math.sqrt(u)));try{r.position.x+=b.x,r.position.y+=b.y,c.position.x-=b.x,c.position.y-=b.y}catch(m){a.slice(G,1);break}}}c=e/parseInt(d);for(A=0;A<a.length;A++)r=a[A],r!==p&&(b.x=r.position.x-l.x,b.y=r.position.y-l.y,
b=b.multiply(c),r.position.x-=b.x,r.position.y-=b.y)},add:function(b){"array"===typeof b?a=a.concat(b):a.push(b)},setDamping:function(a){e=a},setPadding:function(a){g=a},setTarget:function(a){l=a},getItems:function(){return a},getItem:function(b){return a[b]}}};m.FDrop=function(a){function b(a,b){d(a,b);c(a,b);e(a,b);D&&(b.isDirectory=!0)}function c(a,b){var c=new FileReader;c.onload=function(){b.text=c.result;b.type=a.type;b.isFile=!0};c.onprogress=l;c.onerror=k;c.readAsText(a)}function d(a,b){if(a.type.match(p.image)){var c=
new FileReader;c.onload=function(){var d=new Image;d.src=c.result;b.file=d;b.type=a.type;b.isImage=!0};c.onprogress=l;c.onerror=k;c.readAsDataURL(a)}}function e(a,b){var c=new FileReader;c.onload=function(){b.data=c.result;b.type=a.type};c.onprogress=l;c.onloadend=h;c.readAsBinaryString(a)}function g(c){if(null!=c){q=document.createElement("div");q.id="progressBar";q.style.position="absolute";q.style.top="0px";q.style.left="0px";q.style.width="0px";q.style.height="18px";q.style.background="rgba(0, 255, 170, 0.3)";
q.style.color="rgba(255, 255, 255, 0.9)";q.style.paddingLeft="6px";q.style.paddingTop="3px";q.style.zIndex="2000";document.body.appendChild(q);if(1===c.length)c=c[0],r=c.size;else for(var d=0;d<c.length;d++)r+=c[d].size;if(1<c.length)for(n=[],d=0;d<c.length;d++){var e=c[d];n.push(Object.create(t));n[d].id=a.id;n[d].isFileList=!0;n[d].filename=e.name;n[d].size=e.size;n[d].files.push(e.name);b(e,n[d])}else n=Object.create(t),n.id=a.id,n.filename=c.name,n.size=c.size,b(c,n);return n}}function l(a){w=
Math.ceil(a.loaded/r*100);q.style.width=(w+"%").toString();q.innerHTML=(w+"%").toString()}function h(){98<=w&&(onDrop(n),document.body.removeChild(q))}function k(){D=!0}var p={text:/text.*/,image:/image.*/,video:/video.*/,application:/application.*/},t={id:"",isImage:!1,isVideo:!1,isFile:!1,isFileList:!1,isDirectory:!1,filename:"",type:"",data:"",size:0,text:"",file:"",files:[]},n,r=0,w=0,q,D=!1;(function(){var b,c,d,e;window.File&&window.FileReader&&window.FileList&&window.Blob?(b=function(a){a.stopPropagation();
a.preventDefault()},c=function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},d=function(a){a.stopPropagation();a.preventDefault();g(a.dataTransfer.files)},e=function(){},a=a||document.body,a.addEventListener("dragenter",b,!1),a.addEventListener("dragover",c,!1),a.addEventListener("drop",d,!1),a.addEventListener("ondrop",e,!1)):alert("Drag and drop is not fully supported in this browser.")})();return{target:a,event:n,read:g}};m.FFlock={boid:function(a,b){function c(b){for(var c=
0,d=b.length;c<d;c++)C[c]=b[c].position().getDistance(a,!0);c=k(b);c.x*=3;c.y*=3;d=p(b);b=t(b);v.x+=c.x+d.x+b.x;v.y+=c.y+d.y+b.y}function d(){x.x+=v.x;x.y+=v.y;x.length=Math.min(w,x.length);a.x+=x.x;a.y+=x.y;v=new Point}function e(){if(D){D.position=a;var b=x.angle;D.rotate(b-B);B=b}}function g(a){a=h(a,!0);v.x+=a.x;v.y+=a.y}function l(b){var c=y.bounds.size;if(b){100<F&&(F=0,a=new Point.random(c.width,c.height));if(a.x<n||a.x>c.width-n)x.x*=-1,F++;if(a.y<n||a.y>c.height-n)x.y*=-1,F++}else a.x<-n&&
(a.x=c.width+(n-2)),a.y<-n&&(a.y=c.height+(n-2)),a.x>c.width+n&&(a.x=-(n+2)),a.y>=c.height+n&&(a.y=-(n+2));x.isZero()||(a.x+=x.x,a.y+=x.y)}function h(b,c){var d=new Point,e=new Point(b.x-a.x,b.y-a.y),u=e.length;e.length=c&&100>u?.001*w*u:w;d.x=e.x-x.x;d.y=e.y-x.y;d.length=Math.min(q,d.length);return d}function k(b){for(var c=100*n,d=new Point,e=0,u=0,r=b.length;u<r;u++){var p=C[u];if(0<p&&p<c){var t=new Point(a.x-b[u].position().x,a.y-b[u].position().y);t.length=1/p;d.x+=t.x;d.y+=t.y;e++}}0<e&&(d.x/=
e,d.y/=e);d.isZero()||(d.length=w,d.x-=x.x,d.y-=x.y,d.length=Math.min(d.length,q));return d}function p(a){for(var b=new Point,c=0,d=0,e=a.length;d<e;d++){var u=C[d];0<u&&25>u&&(b.x+=a[d].vector().x,b.y+=a[d].vector().y,c++)}0<c&&(b.x/=c,b.y/=c);b.isZero()||(b.length=w,b.x-=x.x,b.y-=x.y,b.length=Math.min(b.length,q));return b}function t(a){for(var b=new Point,c=0,d=0,e=a.length;d<e;d++){var u=C[d];0<u&&1E4>u&&(b.x+=a[d].position().x,b.y+=a[d].position().y,c++)}return 0<c?(b.x/=c,b.y/=c,h(b,!1)):b}
var n=b.radius||30,r=b.strength||.5*Math.random(),w=b.maxSpeed+r||10+r,q=b.maxForce+r||.05+r,D=b.path||null,u=b.data||null,A=b.groupTogether||!0,m=b.bounce||!1,y=b.container||view,z=!1,v=new Point,x=new Point.random(-w*q,w*q);a=new Point(a);var B=0,C=[],F=0;return{run:function(a){A?c(a):p(a);l(m);d();e()},flock:c,update:d,updateItems:e,seek:function(a){a=h(a,!1);v.x+=a.x;v.y+=a.y},arrive:g,borders:l,contain:function(b,c){c=c||{};c.hitOptions=c.hitOptions||{fill:!0,stroke:!0,segment:!0,tolerance:n};
var d=new Point(a.x+x.x+n,a.y+x.y+n);b.position.getDistance(d)<=10*n&&(z=!0);z?b.hitTest(d,c.hitOptions)||(x=new Point(-x.x,-x.y)):z||g(b.position)},repel:function(b,c){c.hitOptions=c.hitOptions||{fill:!0,stroke:!0,segment:!0,tolerance:n};var d=new Point(a.x+x.x,a.y+x.y);if(b.path()){var e=b.path().hitTest(d,c.hitOptions),u=new Point;if(e){if("segment"===e.type||"handle-in"===e.type||"handle-out"===e.type)u=new Point(a.x-e.location.point.x,a.y-e.location.point.y),u=u.normalize();else if("stroke"===
e.type||"fill"===e.type)u.normalize(),u=new Point(d.x-x.x,d.y-x.y);u.x=7*u.x*q;u.y=7*u.y*q;0>Math.sqrt(u.x*u.x+u.y*u.y)&&(u.y=0);v.x+=u.x;v.y+=u.y}}},steer:h,separate:k,align:p,cohesion:t,groupTogether:function(a){return A=a||A},acceleration:function(){return v},vector:function(){return x},position:function(b){void 0!==b&&(a=new Point(b));return a},radius:function(){return n},path:function(){return D},data:function(){return u},maxSpeed:function(){return w},maxForce:function(){return q},bounce:function(){return m}}},
predator:function(a,b){var c=new m.FFlock.boid(a,b);c.run=function(a,b){c.groupTogether()?c.flock(a):c.align(a);c.borders(c.bounce());c.update();c.updateItems();c.repel(b)};c.repel=function(a){for(var e,g=0,l=a.length;g<l;g++)e=a[g],c.seek(e.position()),e.repel(c,b)};return c},obstacle:function(a,b){var c=new m.FFlock.boid(a,b);c.run=function(a){c.repel(a)};c.repel=function(a){for(var e=0,g=a.length;e<g;e++)a[e].repel(c,b)};return c}};m.FNoise={perlin:function(a,b,c){a=a||0;b=b||0;c=c||0;var d,e=
function(a){return a*a*a*(a*(6*a-15)+10)},g=function(a,b,c){return b+a*(c-b)},l=function(a,b,c,d){a&=15;var e=8>a?b:c;b=4>a?c:12===a||14===a?b:d;return(0===(a&1)?e:-e)+(0===(a&2)?b:-b)};(function(){for(var h=Array(512),k=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,
211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,
181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],p=0;256>p;p++)h[256+p]=h[p]=k[p];var t=Math.floor(a)&255,n=Math.floor(b)&255,r=Math.floor(c)&255;a-=Math.floor(a);b-=Math.floor(b);c-=Math.floor(c);var k=e(a),p=e(b),w=e(c),q=h[t]+n,D=h[q]+r,q=h[q+1]+r,n=h[t+1]+n,t=h[n]+r,r=h[n+1]+r;d=(1+g(w,g(p,g(k,l(h[D],a,b,c),l(h[t],a-1,b,c)),g(k,l(h[q],a,b-1,c),l(h[r],a-1,b-1,c))),g(p,g(k,l(h[D+1],a,b,c-1),l(h[t+1],a-1,b,c-1)),g(k,
l(h[q+1],a,b-1,c-1),l(h[r+1],a-1,b-1,c-1)))))/2})();return d}};m.FRoute=function(a,b){b=b||{};var c=b.iterations||1E3,d=0,e=[],g,l,h,k;if(0===d){var e=0,p=[a.length];for(k=0;k<a.length;++k)p[k]=!1,g=a[k].position.x,h=a[k].position.y,g>=view.bounds.width||h>=view.bounds.height||0>g||0>h||(p[k]=!0,e++);e=[e];for(k=g=0;k<a.length;++k)p[k]&&(e[g]=k,g++)}p=e.length-1;if(d<e.length-2){var t=d+1E3;t>p&&(t=p);var n,r;for(k=d;k<t;++k){l=a[e[d]].position;n=0;r=Number.MAX_VALUE;for(var w=d+1;w<p;++w)h=a[e[w]].position,
g=l.x-h.x,h=l.y-h.y,q=g*g+h*h,q<r&&(n=w,r=q);g=e[d+1];e[d+1]=e[n];e[n]=g;d<p?d++:console.log("Optimizing path")}}var q;for(k=0;k<c;++k)if(d=Math.floor(Math.random()*p),t=Math.floor(Math.random()*p),!(2>Math.abs(d-t))&&(t<d&&(g=t,t=d,d=g),r=a[e[d]].position,n=a[e[d+1]].position,w=a[e[t]].position,l=a[e[t+1]].position,g=r.x-n.x,h=r.y-n.y,q=g*g+h*h,g=w.x-l.x,h=w.y-l.y,q+=g*g+h*h,g=r.x-w.x,h=r.y-w.y,r=g*g+h*h,g=n.x-l.x,h=n.y-l.y,r+=g*g+h*h,r<q))for(h=t,d+=1;h>d;)g=e[d],e[d]=e[h],e[h]=g,h--,d++;return e};
m.FSkeleton=function(a){return{getLines:function(a,c,d,e){if(a=a.match(/(z\d+)([lr])/)){var g=a[1];lines[g]||(lines[g]=[void 0,void 0,void 0,void 0]);"r"===a[2]?lines[g][1]=c:"l"===a[2]&&(lines[g][0]=c,lines[g][2]=d,lines[g][3]=e)}},get:function(){centerlinepath=new Path;centerlinepath.closed=!1;for(var b=0,c=a.segments.length;b!==c;b++){--c;var d=a.segments[b].point.x,e=a.segments[b].point.y,g=a.segments[c].point.x,l=a.segments[c].point.y;g===d?e=l-(l-e)/2:e===l?d=g-(g-d)/2:(d=g-(g-d)/2,e=l-(l-e)/
2);e=new Point(d,e);new Path.Circle({center:e,radius:6,strokeColor:new Color({hue:360/a.segments.length*b,saturation:.9,brightness:.9}),strokeWidth:3});e=new Segment(e,a.curves[b].segment2.handleIn,a.curves[b].segment1.handleOut);centerlinepath.add(e)}return centerlinepath}}};m.FSort={alphabetical:function(a,b){a=a.toLowerCase();a=a.replace(/\u00e4/g,"a");a=a.replace(/\u00f6/g,"o");a=a.replace(/\u00fc/g,"u");a=a.replace(/\u00df/g,"s");b=b.toLowerCase();b=b.replace(/\u00e4/g,"a");b=b.replace(/\u00f6/g,
"o");b=b.replace(/\u00fc/g,"u");b=b.replace(/\u00df/g,"s");return a===b?0:a>b?1:-1},distanceToCenter:function(a,b){a=a.getDistanceToCenter();b=b.getDistanceToCenter();return a===b?0:a>b?1:-1}};String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})};String.prototype.trimStart=function(){return this.replace(/^\s\s*/,"")};String.prototype.trimLeft||(String.prototype.trimLeft=String.prototype.trimStart);String.prototype.trimEnd=
function(){return this.replace(/\s\s*$/,"")};String.prototype.trimRight||(String.prototype.trimRight=String.prototype.trimEnd);String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")});String.prototype.toBool=function(){switch(this.toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1;default:return!!this}};String.prototype.reverse=function(){for(var a=this.split("\n"),b="",c=0;c<a.length;c++)a[c].trim(),b=
a[c]+"\n"+b;return b};String.prototype.perLine=function(a,b){b=b||" ";for(var c=this.split(b),d="",e=1,g=0;g<c.length;g++)c[g].trim(),d=0===e%a&&1!==e?d+c[g]+"\n":d+c[g]+b,e++;return d};String.prototype.random=function(a){a=a||36;for(var b="";b.length<a;b+=Math.random().toString(36).substr(2));return b.substr(0,a)};m.FTileEngine=function(a){function b(a,b){var c=e();a=a||Math.ceil(view.bounds.width/c.width);b=b||Math.ceil(view.bounds.height/c.height);p=[];for(var d=[],q=0;q<b;q++){for(var k=0;k<a;k++)0===
q?c=g(c,"right"):0<q&&0<k&&(c=h([{tile:c,side:"right"},{tile:p[q-1][k],side:"bottom"}])),d.push(c);p.push(d);d=[];c=g(p[q][k-a],"bottom")}return p}function c(a){for(var c,d=0;d<a.length;d++){c=a[d];var e=document.getElementById(a[d]),p=e.getAttribute("data-sides"),e={id:e.id,width:e.getBBox().width,height:e.getBBox().height,data:p,top:[],right:[],bottom:[],left:[]};k[c]=e}for(var g in k)for(var u in k)("1"===k[g].data[0]&&"1"===k[u].data[2]||"0"===k[g].data[0]&&"0"===k[u].data[2])&&k[g].top.push(u),
("1"===k[g].data[1]&&"1"===k[u].data[3]||"0"===k[g].data[1]&&"0"===k[u].data[3])&&k[g].right.push(u),("1"===k[g].data[2]&&"1"===k[u].data[0]||"0"===k[g].data[2]&&"0"===k[u].data[0])&&k[g].bottom.push(u),("1"===k[g].data[3]&&"1"===k[u].data[1]||"0"===k[g].data[3]&&"0"===k[u].data[1])&&k[g].left.push(u);b()}function d(a){return"string"===typeof a?k[a]:null}function e(){var a=Object.keys(k);return k[a[Math.floor(a.length*Math.random())]]}function g(a,b){var c=a[b],c=c[parseInt(Math.random()*c.length)];
return k[c]}function l(a){return 2<=a.length?a[0].tile[a[0].side].same(a[1].tile[a[1].side]):!1}function h(a){if(2<=a.length){a=l(a);var b=a[parseInt(Math.random()*a.length)];return d(a[b])}return!1}var k={},p=[];void 0!==a&&c(a);return{tiles:k,createMap:b,set:c,get:d,getRandom:e,getNeighbor:function(a,b){return a[b]},getRandomNeighbor:g,getNeighborMultipleSides:l,getRandomNeighborMultipleSides:h,getMap:function(){return p}}};m.FTriangulate=function(a){function b(){k=[];if(null!==a.length){a=e(a);
a.sort(d);var b=a[0].x,c=a[0].y,g=b,l=c,u,h,m;for(u=0;u<a.length;u++)m=a[u],m.x<b&&(b=m.x),m.x>g&&(g=m.x),m.y<c&&(c=m.y),m.y>l&&(l=m.y);u=g-b;m=l-c;u=u>m?u:m;m=(g+b)/2;l=(l+c)/2;k=[];c=new K;l=new t(new Point(m-2*u,l-u),new Point(m,l+2*u),new Point(m+2*u,l-u));k.push(l);for(u=0;u<a.length;u++){m=a[u];for(var g=[],y=new Point,b=k.length-1;0<=b;b--)if(h=k[b],!c.contains(h)){var z;z=m;var v=h,x=y,B,C,F,E,H,I;1E-6>Math.abs(v.p1.y-v.p2.y)&&1E-6>Math.abs(v.p2.y-v.p3.y)?z=!1:(1E-6>Math.abs(v.p2.y-v.p1.y)?
(C=-(v.p3.x-v.p2.x)/(v.p3.y-v.p2.y),E=(v.p2.x+v.p3.x)/2,I=(v.p2.y+v.p3.y)/2,x.x=(v.p2.x+v.p1.x)/2,x.y=C*(x.x-E)+I):(1E-6>Math.abs(v.p3.y-v.p2.y)?(B=-(v.p2.x-v.p1.x)/(v.p2.y-v.p1.y),F=(v.p1.x+v.p2.x)/2,H=(v.p1.y+v.p2.y)/2,x.x=(v.p3.x+v.p2.x)/2):(B=-(v.p2.x-v.p1.x)/(v.p2.y-v.p1.y),C=-(v.p3.x-v.p2.x)/(v.p3.y-v.p2.y),F=(v.p1.x+v.p2.x)/2,E=(v.p2.x+v.p3.x)/2,H=(v.p1.y+v.p2.y)/2,I=(v.p2.y+v.p3.y)/2,x.x=(B*F-C*E+I-H)/(B-C)),x.y=B*(x.x-F)+H),B=v.p2.x-x.x,v=v.p2.y-x.y,C=B*B+v*v,x.z=Math.sqrt(C),B=z.x-x.x,v=
z.y-x.y,z=B*B+v*v<=C);y.x+y.z<m.x&&c.add(h);z&&(g.push(new n(h.p1,h.p2)),g.push(new n(h.p2,h.p3)),g.push(new n(h.p3,h.p1)),k.splice(b,1))}b=g;b.sort();for(g=1;g<b.length;)b[g-1].p1===b[g].p1&&b[g-1].p2===b[g].p2||b[g-1].p1===b[g].p2&&b[g-1].p2===b[g].p2?b.splice(g,1):g++;g=b;for(b=0;b<g.length-1;b++)for(y=g[b],h=b+1;h<g.length;h++)z=g[h],y.p1===z.p2&&y.p2===z.p1&&(y.p1=null,y.p2=null,z.p1=null,z.p2=null),y.p1===z.p1&&y.p2===z.p2&&(y.p1=null,y.p2=null,z.p1=null,z.p2=null);for(b=0;b<g.length;b++)if(y=
g[b],null!==y.p1&&null!==y.p2){for(h=0;h<p.length;h++)y.p1.name=y.p1===p[h]?"__new":null,y.p2.name=y.p2===p[h]?"__new":null,m.name=m===p[h]?"__new":null;k.push(new t(y.p1,y.p2,m))}}for(u=k.length-1;0<=u;u--)h=k[u],h.sharesVertex(l)&&k.splice(u,1)}}function c(a){for(var b,c=0;c<k.length;c++)for(var d=a.getCentroid.getDistance(k[c].getCentroid),e=0;e<k.length;e++){var g=k[e];if(a.getCentroid.getDistance(g.getCentroid)<d){b=g;break}}return b}function d(a,b){return a.x<b.x?1:a.x>b.x?-1:0}function e(a){a.sort();
for(var b=1;b<a.length;)a[b-1].x===a[b].x&&a[b-1].y===a[b].y?a.splice(b,1):b++;return a}function g(c){p=[];c instanceof Array?(p=c,a=a.concat(c)):(p[0]=c,a.push(c));a=e(a);b()}function l(a){return null!==a?k[a]:k}function h(b){return null!==b?a[b]:a}if(void 0!==a){var k,p=[],t=function(a,b,c){var d,e,g;if(3===arguments.length)d=a,e=b,g=c;else if(1===arguments.length&&3===a.segments.length)d=a.segments[0].point,e=a.segments[1].point,g=a.segments[2].point;else return;return{p1:d,p2:e,p3:g,sharesVertex:function(a){return d===
a.p1||d===a.p2||d===a.p3||e===a.p1||e===a.p2||e===a.p3||g===a.p1||g===a.p2||g===a.p3},getCentroid:function(){return new Point((d.x+e.x+g.x)/3,(d.y+e.y+g.y)/3)},getArea:function(){var a;a=0+(d.x+g.x)*(g.y-d.y);a+=(e.x+d.x)*(d.y-e.y);a+=(g.x+e.x)*(e.y-g.y);return a/2},getWidth:function(){var a=0;d.x<e.x&&d.x<g.x?a=d.x:e.x<d.x&&e.x<g.x?a=e.x:g.x<d.x&&g.x<e.x&&(a=g.x);var b=0;d.x>e.x&&d.x>g.x?b=d.x:e.x>d.x&&e.x>g.x?b=e.x:g.x>d.x&&g.x>e.x&&(b=g.x);return Math.abs(b-a)},getHeight:function(){var a=0;d.y<
e.y&&d.y<g.y?a=d.y:e.y<d.y&&e.y<g.y?a=e.y:g.y<d.y&&g.y<e.y&&(a=g.y);var b=0;d.y>e.y&&d.y>g.y?b=d.y:e.y>d.y&&e.y>g.y?b=e.y:g.y>d.y&&g.y>e.y&&(b=g.y);return Math.abs(b-a)},getPoints:function(){return[d,e,g]}}},n=function(a,b){var c,d;if(2===arguments.length)c=a,d=b;else if(1===arguments.length&&2===a.segments.length)c=a.segments[0].point,d=a.segments[1].point;else return;var e=c.getDistance(d);return{p1:c,p2:d,dist:e,getPoints:function(){return[c,d]}}};b();return{add:g,getTriangles:l,getPoints:h,getClosest:c}}};
var K=function(){var a=[];return{add:function(a){var c=c;-1===c.indexOf(a)&&c.push(a)},get:function(b){return a[b]},size:function(){return a.length},remove:function(a){var c=c;a=c.indexOf(a);-1!==a&&c.splice(a,1)},contains:function(b){for(var c=!1,d=0;d<a.length;d++)a[d]===b&&(c=!0);return c},toString:function(){return a.join(",")}}},E=function(a,b,c,d,e,g,l,h,k,p,t,n,m,w,q,D){this.n11=a||1;this.n12=b||0;this.n13=c||0;this.n14=d||0;this.n21=e||0;this.n22=g||1;this.n23=l||0;this.n24=h||0;this.n31=
k||0;this.n32=p||0;this.n33=t||1;this.n34=n||0;this.n41=m||0;this.n42=w||0;this.n43=q||0;this.n44=D||1;this.clone=function(){return new E(this.n11,this.n12,this.n13,this.n14,this.n21,this.n22,this.n23,this.n24,this.n31,this.n32,this.n33,this.n34,this.n41,this.n42,this.n43,this.n44)};this.concat=function(a){this.init({n11:this.n11*a.n11+this.n12*a.n21+this.n13*a.n31+this.n14*a.n41,n12:this.n11*a.n12+this.n12*a.n22+this.n13*a.n32+this.n14*a.n42,n13:this.n11*a.n13+this.n12*a.n23+this.n13*a.n33+this.n14*
a.n43,n14:this.n11*a.n14+this.n12*a.n24+this.n13*a.n34+this.n14*a.n44,n21:this.n21*a.n11+this.n22*a.n21+this.n23*a.n31+this.n24*a.n41,n22:this.n21*a.n12+this.n22*a.n22+this.n23*a.n32+this.n24*a.n42,n23:this.n21*a.n13+this.n22*a.n23+this.n23*a.n33+this.n24*a.n43,n24:this.n21*a.n14+this.n22*a.n24+this.n23*a.n34+this.n24*a.n44,n31:this.n31*a.n11+this.n32*a.n21+this.n33*a.n31+this.n34*a.n41,n32:this.n31*a.n12+this.n32*a.n22+this.n33*a.n32+this.n34*a.n42,n33:this.n31*a.n13+this.n32*a.n23+this.n33*a.n33+
this.n34*a.n43,n34:this.n31*a.n14+this.n32*a.n24+this.n33*a.n34+this.n34*a.n44,n41:this.n41*a.n11+this.n42*a.n21+this.n43*a.n31+this.n44*a.n41,n42:this.n41*a.n12+this.n42*a.n22+this.n43*a.n32+this.n44*a.n42,n43:this.n41*a.n13+this.n42*a.n23+this.n43*a.n33+this.n44*a.n43,n44:this.n41*a.n14+this.n42*a.n24+this.n43*a.n34+this.n44*a.n44})};this.init=function(a){for(var b in a)this[b]=a[b]};this.createBox=function(a,b,c,d,e,g,p,h,k){this.identity();0!==d&&this.rotateX(d);0!==e&&this.rotateY(e);0!==g&&
this.rotateZ(g);1===a&&1===b&&1===c||this.scale(a,b,c);0===p&&0===h&&0===k||this.translate(p,h,k)};this.identity=function(){this.init({n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1})};this.rotateX=function(a){var b=Math.sin(a);a=Math.cos(a);this.concat(new E(1,0,0,0,0,a,-b,0,0,b,a,0,0,0,0,1))};this.rotateY=function(a){var b=Math.sin(a);a=Math.cos(a);this.concat(new E(a,0,b,0,0,1,0,0,-b,0,a,0,0,0,0,1))};this.rotateZ=function(a){var b=Math.sin(a);a=
Math.cos(a);this.concat(new E(a,-b,0,0,b,a,0,0,0,0,1,0,0,0,0,1))};this.setRotateAxis=function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,g=a.x(),p=a.y(),h=a.z(),k=e*g,t=e*p;this.concat(k*g+c,k*p-d*h,k*h+d*p,0,k*p+d*h,t*p+c,t*h-d*g,0,k*h-d*p,t*h+d*g,e*h*h+c,0,0,0,0,1)};this.scale=function(a,b,c){this.concat(new E(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1))};this.translate=function(a,b,c){this.n41+=a;this.n42+=b;this.n43+=c};this.transformPoint=function(a){return new Vertex3D(this.n11*a.x+this.n21*a.y+this.n31*
a.z+this.n41,this.n12*a.x+this.n22*a.y+this.n32*a.z+this.n42,this.n13*a.x+this.n23*a.y+this.n33*a.z+this.n43)};this.transformArray=function(a){for(var b=[],c=a.length/3,d=0;d<c;d++){var e=3*d,g=a[e],p=a[e+1],h=a[e+2];b[e]=this.n11*g+this.n21*p+this.n31*h+this.n41;b[e+1]=this.n12*g+this.n22*p+this.n32*h+this.n42;b[e+2]=this.n13*g+this.n23*p+this.n33*h+this.n43}return b};this.getPosition=function(){return[this.n12,this.n13,this.n14]};this.setPosition=function(a){this.n12=a.x;this.n13=a.y;this.n14=a.z;
return this};this.makeFrustum=function(a,b,c,d,e,g){this.concat({n11:2*e/(b-a),n12:0,n13:(b+a)/(b-a),n14:0,n21:0,n22:2*e/(d-c),n23:(d+c)/(d-c),n24:0,n31:0,n32:0,n33:-(g+e)/(g-e),n34:-2*g*e/(g-e),n41:0,n42:0,n43:-1,n44:0})};this.makePerspective=function(a,b,c,d){a=c*Math.tan(a*Math.PI/360);var e=-a;this.makeFrustum(e*b,a*b,e,a,c,d)};this.makeOrtho=function(a,b,c,d,e,g){var p=b-a,h=c-d,k=g-e;this.concat({n11:2/p,n12:0,n13:0,n14:-((b+a)/p),n21:0,n22:2/h,n23:0,n24:-((c+d)/h),n31:0,n32:0,n33:-2/k,n34:-((g+
e)/k),n41:0,n42:0,n43:0,n44:1})};this.toString=function(){return this.n11+","+this.n12+","+this.n13+","+this.n14+","+this.n21+","+this.n22+","+this.n23+","+this.n24+","+this.n31+","+this.n32+","+this.n33+","+this.n34+","+this.n41+","+this.n42+","+this.n43+","+this.n44}};m.F3D={FScene3:{},FPoint3:{},FSize3:{},FPath3:function(){}};m.F3D.FPath3=Path.extend({_class:"FPath3",_serializeFields:{segments:[],closed:!1,scene:null,matrix:null,size:null,position3:null,fpoints3:[],rotation:null,translation:null},
initialize:function(a){this._closed=!1;this._segments=[];this._scene=a;this._matrix=new E;this._size=new m.F3D.FSize3;this._position3=new m.F3D.FPoint3;this._fpoints3=[];this._rotation=new m.F3D.FPoint3;this._translation=new m.F3D.FPoint3;this.name="FPath3";Path.call(this);this._initialize()},setScene:function(a){this._scene=a;for(a=0;a<this._fpoints3.length;a++)this._fpoints3[a].setup(this._scene)},add3:function(a){this._fpoints3[this._fpoints3.length]=a},translate:function(a,b,c){"number"===typeof a?
(this._translation.x=a,this._translation.y=b,this._translation.z=c):"object"===typeof a?(this._translation.x=a.x,this._translation.y=a.y,this._translation.z=a.z):(this._translation.x=void 0!==a?a:0,this._translation.y=void 0!==b?b:0,this._translation.z=void 0!==c?c:0);for(a=0;a<this._fpoints3.length;a++)b=this._fpoints3[a],b.setX(b.x+this._translation.x),b.setY(b.y+this._translation.y),b.setZ(b.z+this._translation.z)},rotateX:function(a){this._rotation.x=a},rotateY:function(a){this._rotation.y=a},
rotateZ:function(a){this._rotation.z=a},get:function(){this._segments=[];for(var a=0;a<this._fpoints3.length;a++){var b=this._fpoints3[a];this.add(new Point(b.x2D(),b.y2D()))}return this}});m.F3D.FPath3.inject({statics:new function(){return{FBox:function(a,b,c){this._position3=void 0!==b?b:new m.F3D.FPoint3(0,0,0);this._size=void 0!==c?c:new m.F3D.FSize3(10,10,10);c=[6];for(var d=[new m.F3D.FPoint3(-.5,-.5,-.5),new m.F3D.FPoint3(.5,-.5,-.5),new m.F3D.FPoint3(.5,.5,-.5),new m.F3D.FPoint3(-.5,.5,-.5)],
e=[new m.F3D.FPoint3(-.5,-.5,.5),new m.F3D.FPoint3(.5,-.5,.5),new m.F3D.FPoint3(.5,-.5,-.5),new m.F3D.FPoint3(-.5,-.5,-.5)],g=[new m.F3D.FPoint3(-.5,.5,.5),new m.F3D.FPoint3(.5,.5,.5),new m.F3D.FPoint3(.5,.5,-.5),new m.F3D.FPoint3(-.5,.5,-.5)],l=[new m.F3D.FPoint3(-.5,-.5,-.5),new m.F3D.FPoint3(-.5,-.5,.5),new m.F3D.FPoint3(-.5,.5,.5),new m.F3D.FPoint3(-.5,.5,-.5)],h=[new m.F3D.FPoint3(.5,-.5,-.5),new m.F3D.FPoint3(.5,-.5,.5),new m.F3D.FPoint3(.5,.5,.5),new m.F3D.FPoint3(.5,.5,-.5)],k=[new m.F3D.FPoint3(-.5,
-.5,.5),new m.F3D.FPoint3(.5,-.5,.5),new m.F3D.FPoint3(.5,.5,.5),new m.F3D.FPoint3(-.5,.5,.5)],d=[["front",d],["top",e],["bottom",g],["left",l],["right",h],["back",k]],g=0;g<d.length;g++){c[g]=new m.F3D.FPath3;c[g].name="Z-TOP";e=d[g][1];for(l=0;l<e.length;l++)c[g].add3(new m.F3D.FPoint3(e[l].x*this._size.width,e[l].y*this._size.height,e[l].z*this._size.depth));c[g].closed=!0;c[g].translate(b);a.addItem(c[g])}return new Group(c)},FSphere:function(a,b,c,d){this._position3=void 0!==b?b:new m.F3D.FPoint3(0,
0,0);this._size=void 0!==c?new m.F3D.FSize3(c,c,c):new m.F3D.FSize3(10,10,10);var e;e=void 0!==d?d instanceof Array?d:[d,d]:[6,6];c=[];for(d=0;d<=e[0];d++)for(var g=Math.PI*(-.5+(d-1)/e[0]),l=Math.sin(g),g=Math.cos(g),h=Math.PI*(-.5+d/e[0]),k=Math.sin(h),h=Math.cos(h),p=0;p<=e[1];p++){var t=(p-1)/e[1]*Math.PI*2,n=Math.cos(t),t=Math.sin(t);c.push(new m.F3D.FPoint3(n*g,t*g,l));c.push(new m.F3D.FPoint3(n*h,t*h,k))}e=[c.length-2];for(d=0;d<c.length-2;d++)e[d]=new m.F3D.FPath3,e[d].name="face"+d,e[d].add3(new m.F3D.FPoint3(.5*
c[d].x*this._size.width,.5*c[d].y*this._size.height,.5*c[d].z*this._size.depth)),e[d].add3(new m.F3D.FPoint3(.5*c[d+1].x*this._size.width,.5*c[d+1].y*this._size.height,.5*c[d+1].z*this._size.depth)),e[d].add3(new m.F3D.FPoint3(.5*c[d+2].x*this._size.width,.5*c[d+2].y*this._size.height,.5*c[d+2].z*this._size.depth)),e[d].closed=!0,e[d].translate(b),a.addItem(e[d]);return new Group(e)}}}});m.F3D.FPoint3=this.FPoint3=function(a,b,c){var d=null,e=0,g=0,l=0,h=0,k=0;this.x=void 0!==a?a:0;this.y=void 0!==
b?b:0;this.z=void 0!==c?c:0;this.setup=function(a){d=a;var b=d.setupPoint(this.x,this.y,this.z);a=3*b;b*=2;e=a;g=a+1;l=a+2;h=b;k=b+1};this.random=function(a,b,c,d,e,g){b=b||view.bounds.width;c=c||0;d=d||view.bounds.height;e=e||0;g=d||1E3;this.x=paper.random(a||0,b);this.y=paper.random(c,d);this.z=paper.random(e,g);return new m.F3D.FPoint3(this.x,this.y,this.z)};this.setX=function(a){null!==d&&(d.points3D[e]=a);this.x=a};this.setY=function(a){null!==d&&(d.points3D[g]=a);this.y=a};this.setZ=function(a){null!==
d&&(d.points3D[l]=a);this.z=a};this.set=function(a,b,c){this.setX(a);this.setY(b);this.setZ(c)};this.get=function(){return new m.F3D.FPoint3(this.x,this.y,this.z)};this.x2D=function(){return d.points2D[h]};this.y2D=function(){return d.points2D[k]};this.getSceneIndex=function(){return _sceneIndex};this.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.add=function(a,b,c){"number"===typeof a?(this.x+=a,this.y+=b,this.z+=c):"object"===typeof a&&(this.x+=a.x(),this.y+=a.y(),
this.z+=a.z());this.set(this.x,this.y,this.z)};this.sub=function(a,b,c){"number"===typeof a?(this.x-=a,this.y-=b,this.z-=c):"object"===typeof a&&(this.x-=a.x(),this.y-=a.y(),this.z-=a.z());this.set(this.x,this.y,this.z)};this.scale=function(a){this.x*=a;this.y*=a;this.z*=a;this.set(this.x,this.y,this.z)};this.mult=function(a,b,c){"number"===typeof a?(this.x*=a,this.y*=b,this.z*=c):"object"===typeof a&&(this.x*=a.x(),this.y*=a.y(),this.z*=a.z());this.set(this.x,this.y,this.z)};this.div=function(a,
b,c){"number"===typeof a?(this.x/=a,this.y/=b,this.z/=c):"object"===typeof a&&(this.x/=a.x(),this.y/=a.y(),this.z/=a.z());this.set(this.x,this.y,this.z)};this.getDistance=function(a){var b=this.x-a.x(),c=this.y-a.y();a=this.z-a.z();return Math.sqrt(b*b+c*c+a*a)};this.angleBetween=function(a,b){var c=a.x()*b.x()+a.y()*b.y()+a.z()*b.z(),d=Math.sqrt(a.x()*a.x()+a.y()*a.y()+a.z()*a.z()),e=Math.sqrt(b.x()*b.x()+b.y()*b.y()+b.z()*b.z());return Math.acos(c/(d*e))};this.normalize=function(){var a=this.mag();
0!==a&&1!==a&&this.div(a)};this.toString=function(){return"["+this.x+", "+this.y+", "+this.z+"]"};this.array=function(){return[this.x,this.y,this.z]}};m.F3D.FScene3D=this.FScene3D=function(){function a(a,b){return a.z<b.z?-1:a.z>b.z?1:0}var b="PERSPECTIVE",c=null,d=new m.F3D.FSize3(0,0,0),e=new m.F3D.FPoint3(0,0,0),g=0,l=null,h=null,k=null;this.bounds=new m.F3D.FSize3(0,0,0);this.points3D=[];this.points2D=[];this._ortho=function(){c.makeOrtho(-d.height,d.height,d.height,-d.height,-d.height,d.height)};
this._perspective=function(){c.makePerspective(50,.5*this.bounds.width/this.bounds.height,d.depth,2*this.bounds.depth)};this.setup=function(a,b,e,g){this.points3D=[];this.points2D=[];l=[];c=new E;this.bounds.width=a||paper.view.bounds.width;this.bounds.height=b||paper.view.bounds.height;this.bounds.depth=e||1E3;d.width=.5*this.bounds.width;d.height=.5*this.bounds.height;d.depth=.5*this.bounds.depth;this.setMode(g);h=new Group;k=new Group};this.draw=function(){c.identity();"ORTHO"===b?this._ortho():
this._perspective();c.scale(1,1,1);c.rotateX(e.x);c.rotateY(e.y);c.rotateZ(e.z);c.translate(0,0,this.bounds.depth);var p=c.transformArray(this.points3D),m;for(m=0;m<g;m++){var n=3*m,r=2*m,w=p[n+1],q=this.bounds.depth/(p[n+2]+this.bounds.depth);this.points2D[r]=p[n]*q+d.width;this.points2D[r+1]=w*q+d.height}r=0;n=[];for(m=0;m<l.length;m++)w=l[m],q=this.averageZ(p,r,r+3*w._fpoints3.length),n.push({index:m,z:q}),r+=3*w._fpoints3.length-1;n.sort(a);h.removeChildren();k.removeChildren();for(m=0;m<n.length;m++)p=
l[n[m].index].get(),"Z-TOP"===p.name?k.appendBottom(p):"Z-BOTTOM"===p.name?h.appendBottom(p):null!==p&&h.appendBottom(p);"ORTHO"===b&&(k.scale(200,h.position),h.scale(200,h.position));return new Group(h,k)};this.setupPoint=function(a,b,c){var d=g;this.points2D[this.points2D.length]=0;this.points2D[this.points2D.length]=0;this.points3D[this.points3D.length]=a;this.points3D[this.points3D.length]=b;this.points3D[this.points3D.length]=c;g++;return d};this.averageZ=function(a,b,c){for(var d=0,e=b;e<c;e+=
2)d+=parseInt(a[e+2]);return d/((c-b)/3)};this.setMode=function(a){b=void 0!==a?a:"PERSPECTIVE"};this.addItem=function(a){if(0<a.length)for(var b=0;b<a.length;b++)l[l.length]=a[b],a[b].setScene(this);else l[l.length]=a,a.setScene(this)};this.rotateX=function(a){e.setX(a)};this.rotateY=function(a){e.setY(a)};this.rotateZ=function(a){e.setZ(a)};this.get=function(){return h};this.getBounds=function(){return[this.bounds.width,this.bounds.height,this.bounds.depth]};this.getMatrix=function(){return c};
this.getFocalLength=function(){return this.bounds.depth};this.getScale=function(){return 1}};m.F3D.FSize3=this.FSize3=function(a,b,c){this.width=a||0;this.height=b||0;this.depth=c||0;this.setWidth=function(a){this.width=a};this.setHeight=function(a){this.height=a};this.setDepth=function(a){this.depth=a};this.set=function(a,b,c){this.setWidth(a);this.setHeight(b);this.setDepth(c)};this.get=function(){return new m.F3D.FSize3(this.width,this.height,this.depth)};this.random=function(a,b,c,l,h,k){b=b||
view.bounds.width;c=c||0;l=l||view.bounds.height;h=h||0;k=k||1E3;this.width=paper.random(a||0,b);this.height=paper.random(c,l);this.depth=paper.random(h,k);return this};this.volume=function(){return this.width*this.height*this.depth}};window.addEventListener("DOMContentLoaded",function(){function a(){c.getContext&&(view.viewSize.width=window.innerWidth?window.innerWidth:m.html.clientWidth,view.viewSize.height=window.innerHeight?window.innerHeight:m.html.clientHeight);paper.clear();"function"===typeof Setup&&
Setup();"function"===typeof Draw&&Draw();view.draw()}m.body=m.body||document.body;m.html=m.html||document.documentElement;var b=document.getElementsByTagName("canvas"),c;0===b.length?(b=document.createElement("div"),b.id="container",b.style.position="absolute",b.style.top=0,b.style.left=0,b.style.width="100%",b.style.height="100%",m.body.appendChild(b),c=document.createElement("canvas"),c.id="canvas",c.resize=!0,c.style.backgroundColor="rgba(0, 0, 0, 0)",c.style.webkitUserDrag="none",c.style.webkitUserSelect=
"none",c.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)",b.appendChild(c)):c=b[0];""===c.style.width&&(c.style.width="100%");""===c.style.height&&(c.style.height="100%");paper.setup(c);"function"===typeof Setup&&Setup();"function"===typeof Draw&&Draw();(new Group).name="__AnimationGroup";view.onFrame=function(a){"function"===typeof Update&&Update(a);view&&view.update()};view.onResize=function(a){"function"===typeof onResize&&onResize(a)};b=new Tool;b.onMouseUp=function(a){"function"===typeof onMouseUp&&
onMouseUp(a)};b.onMouseDown=function(a){"function"===typeof onMouseDown&&onMouseDown(a)};b.onMouseMove=function(a){"function"===typeof onMouseMove&&onMouseMove(a)};b.onMouseDrag=function(a){"function"===typeof onMouseDrag&&onMouseDrag(a)};b.onKeyDown=function(a){"function"===typeof onKeyDown&&onKeyDown(a)};b.onKeyUp=function(a){"function"===typeof onKeyUp&&onKeyUp(a)};view.draw();view.update();window.addEventListener("resize",a,!1);window.addEventListener("orientationchange",a,!1);console.log("Folio.js is go!")});
J.folio=m}).call(this);
