<?xml version="1.0" encoding="utf-8"?>
<project name="folio.js" default="prod" basedir="./">



	<description>Folio.js ANT build file</description>



	<target name="-load.properties" description="Set properties for this build">
		<!-- YUI Compressor location -->
		<property name="yui.dir" value="${basedir}/scripts/yuicompressor-2.4.2.jar" />
		<!-- Source Lint/Hint dir -->
		<property name="jslint.js" value="${basedir}/scripts/jslint.js" />
		<!-- Rhino dir -->
        <property name="js.jar" value="${basedir}/scripts/rhino/js.jar"/>
		
		<!-- Source JS dir -->
		<property name="src.dir" value="${basedir}/../src" />
		<property name="src.dir.core" value="${basedir}/../src/Core/" />
		<property name="src.dir.fio" value="${basedir}/../src/FIO/" />
		<property name="src.dir.ftime" value="${basedir}/../src/FTime/" />
		<property name="src.dir.f3d" value="${basedir}/../src/F3D/" />
		<property name="src.dir.libs" value="${basedir}/../src/Libraries/" />

		<!-- Output dir -->
		<property name="distribution.dir" value="${basedir}/../distribution/" />

		<!-- Output dir -->
		<property name="distribution.vers" value="0.5" />
		<property name="distribution.file" value="paper.folio" />

		<!-- Build version information  -->
		<property name="build.major" value="1" />
		<property name="build.minor" value="1" />
	</target>



	<!-- Create distribution directories -->
	<target name="-init" depends="-load.properties"
		description="Create distribution directory structure">
		<!-- Create the time stamp for the new distribution -->
		<tstamp>
			<format property="TODAY" pattern="EEE, d MMM yyyy HH:mm:ss Z" />
		</tstamp>
		
		<!-- Delete previous distribution files -->
		<delete dir="${distribution.dir}" />
		
		<!-- Recreate the distribution directories -->
		<mkdir dir="${distribution.dir}" />
		<!-- <mkdir dir="${distribution.dir}/js" /> -->
		
		<!-- Log the distribution timestamps to file -->
		<echo file="${distribution.dir}/${TODAY}.txt" append="false">Build Date: ${TODAY}</echo>
	</target>



	 <!-- JS Lint -->
	<target depends="-init" name="-js.lint">
		<pathconvert pathsep=" " property="jsfiles">
			<fileset dir="${distribution.dir}/">
				<include name="*.js" />
			</fileset>
		</pathconvert>
		<exec dir="${distribution.dir}/" executable="java" failonerror="true">
			<arg line="-jar ${js.jar} ${jslint.js} ${jsfiles}" />
		</exec>
		<echo>Finished</echo>
	</target>
	

	
	<!-- Concatenate JS files -->
	<target name="-js.concatenate" depends="-js.lint" 
		description="Concatenates specified JavaScript files">
		<concat destfile="${distribution.dir}/${distribution.file}.js">
			<fileset dir="${src.dir}" includes="*.js" />
				<!-- excludes="first.js, second.js" /> -->
			<fileset dir="${src.dir.core}" includes="*.js" />

			<fileset dir="${src.dir.fio}" includes="*.js" />

			<fileset dir="${src.dir.ftime}" includes="FTime.js" />
			<fileset dir="${src.dir.ftime}" includes="*.js" excludes="FTime.js" />
		
			<fileset dir="${src.dir.f3d}" includes="Matrix3D.js" />
			<fileset dir="${src.dir.f3d}" includes="*.js" excludes="Matrix3D.js" />

			<fileset dir="${src.dir.libs}" includes="*.js" />
		</concat>
		<echo>Finished</echo>
	</target>

		
	
	<!-- Minify JS files -->
	<target name="-js.minify" depends="-js.concatenate" 
		description="Minifies JavaScript files">
		<apply executable="java" parallel="false" dest="${distribution.dir}">
			<fileset 
				dir="${distribution.dir}" 
				includes="${distribution.file}.js" />
			<arg line="-jar" />
			<arg path="${yui.dir}" />
			<srcfile/>
			<arg line="-o" />
			<mapper type="glob" from="*.js" to="*.min.js" />
			<targetfile/>
		</apply>
		<echo>Finished</echo>
	</target>



	<!-- Build -->
	<target name="prod" 
		description="Builds project files for production use"
		depends="
			-load.properties, 
			-init, 
			-js.concatenate,
			-js.lint, 
			-js.minify">
	</target>
</project>
