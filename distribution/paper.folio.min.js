var folio=folio||{},body=document.body,html=document.documentElement,Setup=function(){},Draw=function(){},Update=function(){},Animate=function(){},AnimateAdd=function(){},AnimateClear=function(){},onMouseUp=function(){},onMouseDown=function(){},onMouseMove=function(){},onMouseDrag=function(){},onKeyDown=function(){},onKeyUp=function(){};paper.install(window),window.addEventListener("DOMContentLoaded",function(){function a(){project.activeLayer.children.__AnimationGroup&&project.activeLayer.children.__AnimationGroup.remove()}function b(){c.getContext&&(view.viewSize.width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth,view.viewSize.height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight),paper.clear(),"function"==typeof Setup&&Setup(),"function"==typeof Draw&&Draw(),view.draw()}var c,d=document.getElementsByTagName("canvas");if(0===d.length){var e=document.createElement("div");e.id="container",e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.width="100%",e.style.height="100%",document.body.appendChild(e),c=document.createElement("canvas"),c.id="canvas",c.resize=!0,c.style.backgroundColor="rgba(0, 0, 0, 0)",c.style.webkitUserDrag="none",c.style.webkitUserSelect="none",c.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)",e.appendChild(c)}else c=d[0];""===c.style.width&&(c.style.width="100%"),""===c.style.height&&(c.style.height="100%"),paper.setup(c),"function"==typeof Setup&&Setup(),"function"==typeof Draw&&Draw();var f=new Group;f.name="__AnimationGroup",view.onFrame=function(b){"function"==typeof Update&&Update(b),a(),view.update()},view.onResize=function(a){"function"==typeof onResize&&onResize(a)};var g=new Tool;g.onMouseUp=function(a){"function"==typeof onMouseUp&&onMouseUp(a)},g.onMouseDown=function(a){"function"==typeof onMouseDown&&onMouseDown(a)},g.onMouseMove=function(a){"function"==typeof onMouseMove&&onMouseMove(a)},g.onMouseDrag=function(a){"function"==typeof onMouseDrag&&onMouseDrag(a)},g.onKeyDown=function(a){"function"==typeof onKeyDown&&onKeyDown(a)},g.onKeyUp=function(a){"function"==typeof onKeyUp&&onKeyUp(a)},view.draw(),view.update(),window.addEventListener("resize",b,!1),window.addEventListener("orientationchange",b,!1),console.log("Folio.js is go!")}),folio={FTime:{},FIO:{},F3D:{}},PaperScope.inject({enumerable:!0,println:function(a){console.log(a),console.log("\n")},boolToInt:function(a){return a?1:0},numToBool:function(a){return 0!=a?!0:!1},getType:function(a){return a instanceof Point?"Point":a instanceof Size?"Size":a instanceof Rectangle?"Rectangle":a instanceof Group?"Group":a instanceof Raster?"Raster":a instanceof PlacedSymbol?"PlacedSymbol":a instanceof Path?"Path":a instanceof CompoundPath?"CompoundPath":a instanceof Symbol?"Symbol":a instanceof TextItem?"TextItem":Object.prototype.toString.call(a).split(/\W/)[2]},findByName:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];e.name===b&&(c=e)}return c},findById:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d];e.id===b&&(c=e)}return c},forEach:function(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c],c)===!1)return!1;return!0},clear:function(a,b){var c,d,e;2===arguments.length?(c=a,d=b):1===arguments.length&&(c=void 0,d=a);for(var f=0;f<projects.length;f++){if(void 0!==c)try{e=projects[f].layers[c],e.removeChildren()}catch(g){}else projects[f].clear(),e=new Layer;d&&d(e)}}}),PaperScope.inject({enumerable:!0,random:function(a,b){return void 0==b&&(b=a,a=0),a+Math.random()*(b-a)},randomInt:function(a,b){return parseInt(paper.random(a,b))},randomBias:function(a,b,c){var d=[90,9,4,2.33,1.5,1,.66,.43,.25,.11,.01];c=10*Math.max(0,Math.min(c,1));var e=parseInt(Math.floor(c)),f=d[e];return 10>c&&(f+=(d[e+1]-f)*(c-e)),Math.pow(Math.random(),f)*(b-a)+a},clamp:function(a,b,c){return b>a?b:a>c?c:a},normalize:function(a,b,c){return(a-b)/(c-b)},map:function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},round:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},roundMultiple:function(a,b){return Math.floor(a/b)*b+b},snap:function(a,b,c){var c=c||Math.round;return paper.round(b*c(a/b),2)},interpolate:function(a,b,c){return a+(b-a)*c},divisor:function(a){for(var b=[],c=[],d=Math.floor(Math.sqrt(a)),e=1;d>=e;e++)0==a%e&&(b.push(e),e*e!=a&&c.push(a/e));return c.reverse(),b.concat(c)},degrees:function(a){return a*(180/Math.PI)},radians:function(a){return a*(Math.PI/180)},sec:function(a){return 1/Math.cos(a)},cosec:function(a){return 1/Math.sin(a)},slope:function(a,b){var c=b*Math.cos(paper.radians(a)),d=b*Math.sin(paper.radians(a));return new Point(c,d)},slopeRatio:function(a,b){return(b.y-a.y)/(b.x-a.x)},slopeAngle:function(a){return paper.degrees(Math.atan(a.x/a.y))},sq:function(a){return a*a},getCommonTangents:function(a,b){var c=b.position.x-a.position.x,d=b.position.y-a.position.y,e=Math.sqrt(a.bounds.size.getArea()),f=Math.sqrt(b.bounds.size.getArea());e/=2,f/=2;var g=a.position.getDistance(b.position);if(!(g<=Math.abs(f-e))){var h=Math.atan2(d,c),i=Math.acos((e-f)/g),j=new Point(a.position.x+e*Math.cos(h+i),a.position.y+e*Math.sin(h+i)),k=new Point(b.position.x+f*Math.cos(h+i),b.position.y+f*Math.sin(h+i)),l=new Point(a.position.x+e*Math.cos(h-i),a.position.y+e*Math.sin(h-i)),m=new Point(b.position.x+f*Math.cos(h-i),b.position.y+f*Math.sin(h-i));return[j,k,m,l]}},reverser:function(a,b,c){a=a||0,b=b||100,c=c||1;var d=0===a&&100===b?100:1,e=!1,f=0;return function(){return e?f+=c:f-=c,a>f&&!e?e=!0:f>b&&e&&(e=!1),f/d}}}),paper.Color.inject({data:null,toInt:function(){var a=this.red;return a<<=8,a|=this.green,a<<=8,a|=this.blue},toHex:function(){function a(a){var b=a.toString(16);return 1===b.length?"0"+b:b}return"#"+a(255*this.red)+a(255*this.green)+a(255*this.blue)},desaturate:function(a){var b=new Color(this);return b.saturation=paper.clamp(this.saturation-this.saturation*a,0,1),b.setType(this.type),b},saturate:function(a){var b=new Color(this);return b.saturation=paper.clamp(this.saturation+this.saturation*a,0,1),b.setType(this.type),b},darken:function(a){var b=new Color(this);return b.lightness=paper.clamp(this.lightness-this.lightness*a,0,1),b.setType(this.type),b},dim:function(a){var b=new Color(this);return b.brightness=paper.clamp(this.brightness-this.brightness*a,0,1),b.setType(this.type),b},lighten:function(a){var b=new Color(this);return b.lightness=paper.clamp(this.lightness+this.lightness*a,0,1),b.setType(this.type),b},brighten:function(a){var b=new Color(this);return b.saturation=paper.clamp(this.saturation-this.saturation*a,0,1),b.brightness=paper.clamp(this.brightness+this.brightness*a,0,1),b.setType(this.type),b},contrast:function(a){var b=new Color(this);return b.setType(this.type),b.lightness<.5?b.darken(a):b.lighten(a)},invert:function(){var a=new Color(this);return a.hue+=180,a.setType(this.type),a},rotate:function(a){var b=new Color(this);return b.hue+=a,b.setType(this.type),b},interpolate:function(a,b,c){var d=new Color(this);if("number"==typeof b)for(var e=a.getComponents(),f=0;f<d._components.length;f++)d._components[f]=paper.interpolate(d._components[f],e[f],b);else for(var g=a.getComponents(),e=b.getComponents(),f=0;f<d._components.length;f++)d._components[f]=paper.interpolate(g[f],e[f],c);return d.setType(this.type),d},statics:{random:function(a){var b;if("String"===paper.getType(a)){var c=a.substring(1);return new Color.random(parseInt(c.slice(0,2),16)/255,parseInt(c.slice(2,4),16)/255,parseInt(c.slice(4,6),16)/255)}if("Object"===paper.getType(a)){b={};for(var d in a)b[d]="Array"===paper.getType(a[d])?paper.random(a[d][0],a[d][1]):paper.random(0,a[d])}else{b=[];for(var e=arguments.length>0?arguments.length:4,f=0;e>f;f++)"Array"===paper.getType(arguments[f])?b.push(paper.random(arguments[f][0],arguments[f][1])):"Number"===paper.getType(arguments[f])?b.push(paper.random(0,arguments[f])):b.push(paper.random(1))}var g=new Color(b);return g.data="hex"===a?b:null,g.alpha=1,g.setType(b[0]>1?"hsb":"rgb"),g},integer:function(a){return new Color(255&a>>16,255&a>>8,255&a)},bytes:function(a,b,c,d){return 4===arguments.length?new Color(a/255,void 0!=b?b/255:a/255,void 0!=c?c/255:a/255,void 0!=d?d/255:1):new Color(a/255,void 0!=b?b/255:a/255,void 0!=c?c/255:a/255)}}});var FConversions={PIXEL_TO_MM:.352777778,MM_TO_PIXEL:2.83464567,POINT_TO_MM:.352777778,MM_TO_POINT:2.83464567,PIXEL_TO_CM:.0352777778,CM_TO_PIXEL:28.3464567,POINT_TO_CM:.0352777778,CM_TO_POINT:28.3464567,PIXEL_TO_INCH:.0138888889,INCH_TO_PIXEL:72,POINT_TO_INCH:.0138888889,INCH_TO_POINT:72,PIXEL_TO_PICA:.0833333333,PICA_TO_PIXEL:12,POINT_TO_PICA:.0833333333,PICA_TO_POINT:12};paper.Item.inject({enumerable:!0,_prevAngle:0,_prevPosition:{x:0,y:0},_prevHor:1,_prevVer:1,snap:function(a,b){this.position.snap(a,b)},getDistanceToCenter:function(){if(void 0!=this._position){var a=this._position.x-view.bounds.center.x,b=this._position.y-view.bounds.center.y;return a*a+b*b+1}},toGroup:function(){return"CompoundPath"===paper.getType(this)?new Group(this.children):this},setRotation:function(a,b){return b=b||this.point,this.rotate(-(a-this._prevAngle),b),this._prevAngle=a,this},setTranslation:function(a){return a=new Point(a),this.translate(new Point(a.x-this._prevPosition.x,a.y-this._prevPosition.y)),this._prevPosition=a,this},setScaling:function(a,b){return b=b||1,this.scale(1+(a-this._prevHor),1+(b-this._prevVer),this.position),this._prevHor=a,this._prevVer=b,this}}),paper.Path.inject({getCentroid:function(){for(var a=new Point(0,0),b=0,c=0,d=[],e=0;e<this._segments.length-1;++e)d[0]=this._segments[e].point,d[1]=this._segments[e+1].point,c=d[0].x*d[1].y-d[1].x*d[0].y,b+=c,a.x+=(d[0].x+d[1].x)*c,a.y+=(d[0].y+d[1].y)*c;return d[0]=this._segments[e].point,d[1]=this._segments[0].point,c=d[0].x*d[1].y-d[1].x*d[0].y,b+=c,a.x+=(d[0].x+d[1].x)*c,a.y+=(d[0].y+d[1].y)*c,b*=.5,a.x/=6*b,a.y/=6*b,a},getCircumcenter:function(){function a(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=c.x-a.x,g=c.y-a.y,h=d*(a.x+b.x)+e*(a.y+b.y),i=f*(a.x+c.x)+g*(a.y+c.y),j=2*(d*(c.y-b.y)-e*(c.x-b.x));if(Math.abs(j)<Numerical.EPSILON){var k=[a.x,b.x,c.x],l=[a.y,b.y,c.y],m=k.min(),n=l.min(),o=k.max(),p=l.max();return new Point((k[m]+k[o])/2,(l[n]+l[p])/2)}var q=(g*h-e*i)/j,r=(d*i-f*h)/j;return new Point(q,r)}for(var b=this._segments.length,c=[],d=[],e=0;b>e;e++){var f=e+1>=b?0:e+1,g=e+2>=b?1:e+2,h=a(this._segments[e].point,this._segments[f].point,this._segments[g].point);c.push(h.x),d.push(h.y)}return new Point(c.median(),d.median())},getCircumcircle:function(){function a(a){var c=a.point,d=c.x-b.getCircumcenter().x,e=c.y-b.getCircumcenter().y,f=d*d+e*e;return Math.sqrt(f)}var b=this,c=0,d=this._segments.slice();return d.sort(function(b,c){return a(b)-a(c)}),c=a(d[d.length-1])+a(d[d.length-2]),c/=2,Path.Circle(b.getCircumcenter(),c)},getIncircle:function(){for(var a=Number.MAX_VALUE,b=0;b<this._segments.length;b++){var c=this._segments[b].point;c.getDistance(this.getCentroid())<a&&(a=c.getDistance(this.getCentroid()))}return Path.Circle(this.getCentroid(),a)},statics:new function(){return{FArrow:function(a,b,c){var d=new Path.Line(a,b),c=c||new Size(.381924*a.getDistance(b),.381924*a.getDistance(b)),e=Math.atan2(a.x-b.x,b.y-a.y),f=[];f[0]=new Path.Line(new Point(0,0),new Point(-c.width,-c.height)),f[1]=new Path.Line(new Point(0,0),new Point(c.width,-c.height));for(var g=0;g<f.length;g++)f[g].rotate(180+paper.degrees(e),new Point(0,0)),f[g].translate(a);var h=new Group([d,f[0],f[1]]);return h.name="arrow",h},FBubble:function(a,b,c,d){var e=new Path;e.name="bubble";var c=c||defaultFBubbleTagSize;b.width<10&&(b.width=10,c=new Size(10,10));var d=d||"RANDOM";e.add(new Point(0,0));var f=180,g=new Point(b.height/2+Math.cos(paper.radians(f))*b.height,b.height/2+Math.sin(paper.radians(f))*b.height);e.arcTo(g,new Point(0,b.height));var h=paper.randomInt(0,b.width-c.width);e.add(new Point(h,b.height));var i,j;return i="LEFT"==d?h:"CENTER"==d?h+c.width/2:"RIGHT"==d?h+c.width:paper.randomInt(h,h+c.width),j=b.height+c.height,e.add(new Point(i,j)),e.add(new Point(h+c.width,b.height)),e.add(new Point(b.width,b.height)),f=0,g=new Point(b.height/2+Math.cos(paper.radians(f))*(b.height/2),b.height/2+Math.sin(paper.radians(f))*(b.height/2)),e.arcTo(new Point(b.width,0),!1),e.closed=!0,e.position=new Point(a.x,a.y+c.height/2),e},FChain:function(a,b,c,d){var e,f;"Point"===paper.getType(a)?(e=new Path.Circle(a,b),f=new Path.Circle(c,d)):(e=a,f=b);var g=paper.getCommonTangents(e,f),h=new Path;if(null!=g){h.name="chain",h.add(g[0]),h.add(g[1]),angle=f.position.x>e.position.x?0:f.position.y<e.position.y?-90:f.position.y>e.position.y?90:180;var i=new Point(f.position.x+Math.cos(paper.radians(angle))*(f.bounds.width/2),f.position.y+Math.sin(paper.radians(angle))*(f.bounds.height/2));h.arcTo(i,g[2]),h.add(g[2]),h.add(g[3]),angle=e.position.x>f.position.x?0:e.position.y<f.position.y?-90:e.position.y>f.position.y?90:180;var j=new Point(e.position.x+Math.cos(paper.radians(angle))*(e.bounds.width/2),e.position.y+Math.sin(paper.radians(angle))*(e.bounds.height/2));h.arcTo(j,g[0]),h.closed=!0}return h},FCross:function(a,b,c,d){var e,f,c=c||1,d=d||"LINE";"LINE"==d?(e=new Path.Line(a.x+b.width,a.y-b.height,a.x-b.width,a.y+b.height),e.strokeWidth=c,f=new Path.Line(a.x+b.width,a.y+b.height,a.x-b.width,a.y-b.height),f.strokeWidth=c):"SHARP"==d&&(e=new Path,e.add(new Point(a.x+b.width,a.y-b.height)),e.add(new Point(a.x+b.width,a.y-b.height+c/2)),e.add(new Point(a.x-b.width+c/2,a.y+b.height)),e.add(new Point(a.x-b.width,a.y+b.height)),e.add(new Point(a.x-b.width,a.y+b.height-c/2)),e.add(new Point(a.x+b.width-c/2,a.y-b.height)),e.closed=!0,f=new Path,f.add(new Point(a.x-b.width,a.y-b.height)),f.add(new Point(a.x-b.width+c/2,a.y-b.height)),f.add(new Point(a.x+b.width,a.y+b.height-c/2)),f.add(new Point(a.x+b.width,a.y+b.height)),f.add(new Point(a.x+b.width-c/2,a.y+b.height)),f.add(new Point(a.x-b.width,a.y-b.height+c/2)),f.closed=!0);var g=new Group([e,f]);return g.name="cross",g},FDrip:function(a,b){var c=new Path;return c.name="drop",c.add(new Segment(new Point(-.01,.01),new Point(0,-.0055078),new Point(0,.643042))),c.add(new Segment(new Point(-.65,1.6381104),new Point(0,-.6109619),new Point(0,.3694434))),c.add(new Segment(new Point(0,2.31),new Point(-.3578369,0),new Point(.3578369,0))),c.add(new Segment(new Point(.65,1.6381104),new Point(0,.3694434),new Point(0,-.6109619))),c.add(new Segment(new Point(.01,.01),new Point(0,.643042),new Point(0,-.0055078))),c.add(new Segment(new Point(0,-0),new Point(.0055078,0),new Point(-.0055078,0))),c.closed=!0,c.position=a,"Size"==typeof b?c.scale(b.width,b.height):c.scale(b),c},FTriangle:function(a,b,c){var d=new Path;return d.add(a),d.add(b),d.add(c),d.closed=!0,d.name="triangle",d}}}}),paper.Point.inject({name:null,data:{},snap:function(a,b){var c,d,b=void 0!=b?b:{grid:!0,isometric:!1},a="Size"===a.type?a:new Size(a,a);return b.isometric===!0?(c=Math.round(this.y/(16*a.height)-this.x/(32*a.width)),d=Math.round(this.y/(16*a.height)+this.x/(16*a.width)),this.x=(d-c)/2*32*a.width,this.y=(d+c)/2*16*a.height):(c=Math.round(this.y/a.height-this.x/a.width),d=Math.round(this.y/a.height+this.x/a.width),this.x=(d-c)/2*a.width,this.y=(d+c)/2*a.height),this},interpolateTo:function(a,b){return new Point(this.x+(a.x-this.x)*b,this.y+(a.y-this.y)*b)},invertX:function(){return this.x=view.bounds.width-this.x,this},invertY:function(){return this.y=view.bounds.height-this.y,this},getDistanceToCenter:function(){return this.getDistance(view.bounds.center)},getMid:function(a){return new Point((this.x+a.x)/2,(this.y+a.y)/2)},getPerpendicularBisector:function(a){function b(a,b){var c=a.y-b.y,d=a.x-b.x;return[c,-d,d*a.y-c*a.x]}var c=this.getMid(a),d=b(new Point(c.x-(this.y-c.y),c.y+(this.x-c.x)),new Point(c.x-(a.y-c.y),c.y+(a.x-c.x)));return d},getSlope:function(a){return paper.slopeRatio(this,a)},getHeading:function(){return-1*Math.atan2(-this.y,this.x)},getAngle:function(a){var a=a||new Point(0,0);return Math.atan2(a.y-this.y,a.x-this.x)},norm:function(a,b){return this.x=paper.normalize(this.x,a.x,b.x),this.y=paper.normalize(this.y,a.y,b.y),this},magSq:function(){return this.x*this.x+this.y*this.y},statics:{interpolateTo:function(a,b,c){return a.interpolateTo(b,c)},invertX:function(a){var a=new Point(a);return a.invertX()},invertY:function(a){var a=new Point(a);return a.invertY()},random:function(a,b){var c="array"==typeof a?paper.random(a[0],a[1]):paper.random(a),d="array"==typeof a?paper.random(b[0],b[1]):paper.random(b);return new Point(c,d)}}}),paper.Size.inject({getArea:function(){return this.width*this.height},getCircumarea:function(){var a=this.getCircumradius();return Math.PI*a*a},getIncirclearea:function(){var a=this.getIncircleradius();return Math.PI*a*a},getCircumradius:function(){var a=this.width,b=this.height;return Math.sqrt(a*a+b*b)/2},getIncircleradius:function(){return this.width<this.height?this.width/2:this.height/2},getSlopeAngle:function(){return Math.atan(this.width/this.height)}}),paper.TextItem.inject({trimToFit:function(){var a=this.visibleRange.content.trim();return this.content=a,this}}),folio.FTime={FDate:{},FStopwatch:{},FStepper:{},Ease:{}},folio.FTime.Ease=function(){function a(a,b){function c(a,b){return 1-3*b+3*a}function d(a,b){return 3*b-6*a}function e(a){return 3*a}function f(a,b,f){return((c(b,f)*a+d(b,f))*a+e(b))*a}function g(a,b,f){return 3*c(b,f)*a*a+2*d(b,f)*a+e(b)}function h(a){for(var b=a,c=0;4>c;++c){var d=g(b,j[0],j[2]);if(0==d)return b;var e=f(b,j[0],j[2])-a;b-=e/d}return b}function i(a){return j[0]==j[1]&&j[2]==j[3]?a:f(h(a),j[1],j[3])}var j;return a instanceof Array?j=a:(a=a.normalize(),b=b.normalize(),j=[a.x,a.y,b.x,b.y]),{get:i}}return{linear:function(a){return a},inQuad:function(a){return a*a},outQuad:function(a){return a*(2-a)},inOutQuad:function(a){return.5>a?2*a*a:-1+(4-2*a)*a},inCubic:function(a){return a*a*a},outCubic:function(a){return--a*a*a+1},inOutCubic:function(a){return.5>a?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},inQuart:function(a){return a*a*a*a},outQuart:function(a){return 1- --a*a*a*a},inOutQuart:function(a){return.5>a?8*a*a*a*a:1-8*--a*a*a*a},inQuint:function(a){return a*a*a*a*a},outQuint:function(a){return 1+--a*a*a*a*a},inOutQuint:function(a){return.5>a?16*a*a*a*a*a:1+16*--a*a*a*a*a},inSine:function(a){return-1*Math.cos(a*(Math.PI/2))+1},outSine:function(a){return 1*Math.sin(a*(Math.PI/2))},inOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},inExpo:function(a){return 1*Math.pow(2,10*(a-1))},outExpo:function(a){return 1*(-Math.pow(2,-10*a)+1)},inOutExpo:function(a){return a/=.5,1>a?.5*Math.pow(2,10*(a-1)):(a--,.5*(-Math.pow(2,-10*a)+2))},inCirc:function(a){return-1*(Math.sqrt(1-a*a)-1)},outCirc:function(a){return a--,1*Math.sqrt(1-a*a)},inOutCirc:function(a){return a/=.5,1>a?-.5*(Math.sqrt(1-a*a)-1):(a-=2,.5*(Math.sqrt(1-a*a)+1))},spline:a}},folio.FTime.FDate=function(){var a=new Date,b=function(a){return 1===a.length&&(a="0"+a),a},c=function(){void 0===a&&(a=new Date);var b=String(a.getFullYear());return b},d=function(){return void 0===a&&(a=new Date),String(a.getMonth())},e=function(){return void 0===a&&(a=new Date),String(a.getDate())},f=function(){void 0===a&&(a=new Date);var c=String(a.getHours());return b(c)},g=function(){void 0===a&&(a=new Date);var c=String(a.getMinutes());return b(c)},h=function(){void 0===a&&(a=new Date);var c=String(a.getSeconds());return b(c)},i=function(){return c()+d()+e()},j=function(a){var b=a||[!0,!0,!0],c="";return b[0]&&(c+=f()),b[0]&&b[1]&&(c+=":"),b[1]&&(c+=g()),b[1]&&b[2]&&(c+=":"),b[2]&&(c+=h()),c},k=function(){return p(f(),g(),h())},l=function(b,c,d,e){return a+(24*b+60*c+60*d+1e3*e)},m=function(b,c,d,e){return a-(24*b+60*c+60*d+1e3*e)},n=function(a,b,c,d){return time=new Date,time.setTime(24*a+60*b+60*c+1e3*d),time},o=function(a,b){var c,d,e,f=b||[!0,!0,!0],g=parseInt(a/1e3%60),h=parseInt(a/1e3/60%60),i=parseInt(a/1e3/60/60%24);c=10>i?"0"+i:""+i,d=10>h?"0"+h:""+h,e=10>g?"0"+g:""+g;var j="";return f[0]&&(j+=c),f[0]&&f[1]&&(j+=":"),f[1]&&(j+=d),f[1]&&f[2]&&(j+=":"),f[2]&&(j+=e),j},p=function(a,b,c){return void 0===b&&void 0===c&&(a=q(a)[0],b=q(a)[1],c=q(a)[2]),parseInt(36e5*a+6e4*b+1e3*c)},q=function(a){var b=a.split(":");return[b[0],b[1],b[2]]};return{year:c,month:d,day:e,hour:f,minute:g,second:h,date:i,now:j,nowMilliseconds:k,add:l,sub:m,set:n,get:o,toMillsecond:p,toArray:q}},folio.FTime.FStepper=function(){function a(a){if(j&&(j=!1,g=a,h=k?paper.round(a+(1-m)*f,3):paper.round(a+m*f,3),a>=h&&(k?(k=!1,m=1):(l=!1,m=0))),k){if(m=paper.round(1-(h-a)/f,3),a==h)return k=!1,m=1,n++,void 0}else if(l&&(m=paper.round((h-a)/f,3),a==h))return k=!1,m=0,n++,void 0}function b(){j=k=l=!1}function c(a){d(parseInt(1e3*a))}function d(a){f=a,f/=1e3}function e(a){m=a}var f=1e3,g=0,h=0,i=0,j=!1,k=!1,l=!1,m=1,n=0,o=function(){return 0===i?(i=1,q()):(i=0,p()),i},p=function(){j=!0,k=!0,l=!1},q=function(){j=!0,l=!0,k=!1},r=function(){return k},s=function(){return l},t=function(){return 1>m&&m>0?!1:m>1?(m=1,!0):0>m?(m=0,!0):void 0},u=function(){return m},v=function(){return n};return{delta:u,counter:v,toggle:o,update:a,stepIn:p,stepOut:q,isIn:r,isOut:s,isDone:t,stop:b,setSeconds:c,setMillis:d,setDelta:e}},folio.FTime.FStopwatch=function(){var a,b,c=0,d=0,e=function(){0==d?f():g()},f=function(){d=1,b=new Date,b.setTime(b.getTime()-c)},g=function(){d=0,a=new Date,c=a.getTime()-b.getTime()},h=function(){d=0,c=0},i=function(a,f){c=a,d=f?0:1,b=new Date,b.setTime(b.getTime()-c),e()},j=function(){return 1==d&&(a=new Date,c=a.getTime()-b.getTime()),c},k=function(){return 0===d?!0:!1};return{toggle:e,start:f,pause:g,reset:h,set:i,get:j,isRunning:k}},folio.FIO={saveLocal:function(a,b){window.localStorage?localStorage.setItem(a,String(b)):console.error("localStorage not supported")},getLocal:function(a){return localStorage.getItem(a)},getLocalInt:function(a){return parseInt(getLocal(a))},getLocalFloat:function(a){return parseFloat(getLocal(a))},getAllLocal:function(){return sessionStorage},deleteLocal:function(a){localStorage.removeItem(a)},saveSession:function(a,b){window.sessionStorage?sessionStorage.setItem(a,String(b)):console.error("sessionStorage not supported")},getSession:function(a){return sessionStorage.getItem(a)},getSessionInt:function(a){return parseInt(getSession(a))},getSessionFloat:function(a){return parseFloat(getSession(a))},getAllSession:function(){return sessionStorage},deleteSession:function(a){sessionStorage.removeItem(a)},saveCookie:function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+1e3*60*60*24*c);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"},openCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}},deleteCookie:function(a){saveCookie(a,"",-1)},downloadSVG:function(a,b,c){var d=b||view.bounds.width,e=c||view.bounds.height,f='<svg id="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 '+d+" "+e+'" enable-background="new 0 0 '+d+" "+e+'" xml:space="preserve">';f+=pathGroup.exportSVG({asString:!0}),f+="</svg>";var g=btoa(f),h=document.createElement("svg");h.src="data:image/svg+xml;base64,\n"+g,h.alt=a;try{var i=document.createElement("a");return i.download=a,i.href=h.src,i.click(),!0}catch(j){return!1}},saveFile:function(a,b){b=b||"foliojs_fio_file.file";try{var c=new File(script.file.parent,fname);return c.exists()&&c.remove(),c.open(),c.write(Json.encode(a)),c.close(),!0}catch(d){}try{var e=document.createElement("a");return e.download=b,e.href=a,e.click(),!0}catch(d){}return!1},openFile:function(a){var b=new File(script.file.parent,a);b.open();var c=Json.decode(b.readAll());return b.close(),c},deleteFile:function(a){var b=new File(script.file.parent,a);b.exists()&&b.remove()},checkFile:function(a){var b=new File(script.file.parent,a);return b.exists()?!0:!1}},Array.prototype.median=function(){var a=Object.prototype.toString.call(this).split(/\W/)[2];if("Array"===a){var b=0;return this.sort(),b=0===this.length%2?(this[this.length/2-1]+this[this.length/2])/2:this[(this.length-1)/2]}},Array.prototype.average=function(){var a=Object.prototype.toString.call(this).split(/\W/)[2];if("Array"===a){for(var b=0,c=0;c<this.length,isFinite(this[c]);c++)b+=parseFloat(this[c]);return b/this.length-1}},Array.prototype.merge=function(a){var b=Object.prototype.toString.call(this).split(/\W/)[2];if("Array"===b){var c=this.concat(a);return c}},Array.prototype.combine=function(a){for(item in this)a[item]=void 0!=a[item]?a[item]:this[item];return a},Array.prototype.findIndex=function(a){for(var b=this.length-1;b>=0&&this[b].toLowerCase()!==a.toLowerCase();b--);return b},Array.prototype.max=function(a,b){a=void 0!=a?a:0,b=void 0!=b?b:this.length;for(var c=a,d=a+1;b>d;d++)this[d]>this[c]&&(c=d);return c},Array.prototype.min=function(a,b){a=void 0!=a?a:0,b=void 0!=b?b:this.length;for(var c=a,d=a+1;b>d;d++)this[d]<this[c]&&(c=d);return c},Array.prototype.shuffle=function(){for(var a,b,c=this.length;c;a=parseInt(Math.random()*c),b=this[--c],this[c]=this[a],this[a]=b);},Array.prototype.unique=function(){var a=[];a:for(var b=0,c=this.length;c>b;b++){for(var d=0,e=a.length;e>d;d++)if(a[d]==this[b])continue a;a[a.length]=this[b]}return a},Array.prototype.removeDuplicates=function(){var a=Object.prototype.toString.call(this).split(/\W/)[2];return"Array"===a?this.reduce(function(a,b){return-1===a.indexOf(b)&&a.push(b),a},[]):void 0},Array.prototype.round=function(a){for(var b=Math.pow(10,a),c=0;c<this.length;c++)this[c]=Math.round(this[c]*b)/b;return this},Array.prototype.same=function(a){for(var b=this.concat(),c=[],d=0;d<b.length;++d)for(var e=0;e<a.length;++e)b[d]===a[e]&&c.push(b[d]);return c};var FSort={alphabetical:function(a,b){return a=a.toLowerCase(),a=a.replace(/ä/g,"a"),a=a.replace(/ö/g,"o"),a=a.replace(/ü/g,"u"),a=a.replace(/ß/g,"s"),b=b.toLowerCase(),b=b.replace(/ä/g,"a"),b=b.replace(/ö/g,"o"),b=b.replace(/ü/g,"u"),b=b.replace(/ß/g,"s"),a==b?0:a>b?1:-1},distanceToCenter:function(a,b){var c=a.getDistanceToCenter(),d=b.getDistanceToCenter(),e=0;return c>d?e=-1:d>c&&(e=1),e}};folio.FCirclePack=function(a,b){function c(){a=a.sort(FSort.distanceToCenter);for(var c=new Point,d=a.length-1;d>=0;--d)for(var e=a[d],f=d+1;f<a.length;f++){var g=a[f];if(d!=f){var k=g.position.x-e.position.x,l=g.position.y-e.position.y,m=e.bounds.size.width/2+g.bounds.size.width/2+i,n=k*k+l*l;if(m*m-.01>n){c.x=k,c.y=l,c=c.normalize(1),c=c.multiply(.5*(m-Math.sqrt(n)));try{g.position.x+=c.x,g.position.y+=c.y,e.position.x-=c.x,e.position.y-=c.y}catch(o){a.slice(f,1);break}}}}for(var p=h/parseInt(b),d=0;d<a.length;d++){var q=a[d];c.x=q.position.x-j.x,c.y=q.position.y-j.y,c=c.multiply(p),q.position.x-=c.x,q.position.y-=c.y}}function d(b){"array"==typeof b?a=a.concat(b):a.push(b)}function e(a){h=a}function f(a){i=a}function g(a){j=a}var a=a instanceof Group?a.children:null==a?[]:a;b=void 0!=b?b:11;var h=.1,i=0,j=view.center,k=function(){return a},l=function(b){return a[b]};return{update:c,add:d,setDamping:e,setPadding:f,setTarget:g,getItems:k,getItem:l}},folio.FDrop=function(a){function b(a,b){f(a,b),e(a,b),g(a,b),q&&(b.isDirectory=!0)}function c(c){if(c.length>1){l=[];for(var d=0;d<c.length;d++){var e=c[d];l.push(Object.create(o)),l[d].id=a.id,l[d].isFileList=!0,l[d].filename=e.name,l[d].size=e.size,l[d].files.push(e.name),b(e,l[d])}}else l=Object.create(o),l.id=a.id,l.filename=c.name,l.size=c.size,b(c,l);return l}function d(){m=document.createElement("div"),m.id="progressBar",m.style.position="absolute",m.style.top="0px",m.style.left="0px",m.style.width="0px",m.style.height="18px",m.style.background="rgba(0, 255, 170, 0.3)",m.style.color="rgba(255, 255, 255, 0.9)",m.style.paddingLeft="6px",m.style.paddingTop="3px",m.style.zIndex="2000",document.body.appendChild(m)}function e(a,b){var c=new FileReader;c.onload=function(){b.text=c.result,b.type=a.type,b.isFile=!0},c.onprogress=i,c.onerror=k,c.readAsText(a)}function f(a,b){if(a.type.match(n.image)){var c=new FileReader;c.onload=function(){var d=new Image;d.src=c.result,b.file=d,b.type=a.type,b.isImage=!0},c.onprogress=i,c.onerror=k,c.readAsDataURL(a)}}function g(a,b){var c=new FileReader;c.onload=function(){b.data=c.result,b.type=a.type},c.onprogress=i,c.onloadend=j,c.readAsBinaryString(a)}function h(a){if(null!=a){if(d(),1===a.length)a=a[0],p=a.size;else for(var b=0;b<a.length;b++)p+=a[b].size;return c(a)}}function i(a){totalLoad=Math.ceil(100*(a.loaded/p)),m.style.width=(totalLoad+"%").toString(),m.innerHTML=(totalLoad+"%").toString()}function j(){totalLoad>=98&&(onDrop(l),document.body.removeChild(m))}function k(){q=!0}var l,m,n={text:/text.*/,image:/image.*/,video:/video.*/,application:/application.*/},o={id:"",isImage:!1,isVideo:!1,isFile:!1,isFileList:!1,isDirectory:!1,filename:"",type:"",data:"",size:0,text:"",file:"",files:[]},p=totalLoad=0,q=!1;return function(){function b(a){a.stopPropagation(),a.preventDefault()}function c(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function d(a){a.stopPropagation(),a.preventDefault(),h(a.dataTransfer.files)}function e(){}window.File&&window.FileReader&&window.FileList&&window.Blob?(a=a||document.body,a.addEventListener("dragenter",b,!1),a.addEventListener("dragover",c,!1),a.addEventListener("drop",d,!1),a.addEventListener("ondrop",e,!1)):alert("Drag and drop is not fully supported in this browser.")}(),{target:a,event:l,read:h}},folio.FFlock={boid:function(a,b){function c(a){J?o(a):d(a),j(),f(),g()}function d(a){e(a);var b=n(a);b.x*=3,b.y*=3;var c=o(a),d=p(a);F.x+=b.x+c.x+d.x,F.y+=b.y+c.y+d.y}function e(b){for(var c=0,d=b.length;d>c;c++){var e=b[c];I[c]=e.position().getDistance(a,!0)}}function f(){G.x+=F.x,G.y+=F.y,G.length=Math.min(B,G.length),a.x+=G.x,a.y+=G.y,F=new Point}function g(){if(D){D.position=a;var b=G.angle;D.rotate(b-H),H=b}}function h(a){var b=m(a,!1);F.x+=b.x,F.y+=b.y}function i(a){var b=m(a,!0);F.x+=b.x,F.y+=b.y}function j(){var b=new Point,c=view.size;a.x<-A&&(b.x=c.width+A),a.y<-A&&(b.y=c.height+A),a.x>c.width+A&&(b.x=-c.width-A),a.y>c.height+A&&(b.y=-c.height-A),b.isZero()||(a.x+=b.x,a.y+=b.y)}function k(b,c){c=c||{},c.hitOptions=c.hitOptions||{fill:!0,stroke:!0,segment:!0,tolerance:A/2};var d=new Point(a.x+G.x+A,a.y+G.y+A),e=b.position.getDistance(d);if(10*A>=e&&(K=!0),K){var f=b.hitTest(d,c.hitOptions);f||(G=new Point(-G.x,-G.y))}else K||i(b.position)}function l(b,c){c.hitOptions=c.hitOptions||{fill:!0,stroke:!0,segment:!0,tolerance:A/2};var d=new Point(a.x+G.x,a.y+G.y);if(b.path()){var e=b.path().hitTest(d,c.hitOptions),f=new Point;e&&("stroke"==e.type||"segment"==e.type||"handle-in"==e.type||"handle-out"==e.type?(f=new Point(a.x-e.location.point.x,a.y-e.location.point.y),f=f.normalize()):"fill"==e.type&&(f=new Point(a.x*-G.x,a.y*-G.y)),f.x*=7*C,f.y*=7*C,Math.sqrt(f.x*f.x+f.y*f.y)<0&&(f.y=0),F.x+=f.x,F.y+=f.y)}}function m(b,c){var d=new Point,e=new Point(b.x-a.x,b.y-a.y),f=e.length;return e.length=c&&100>f?B*.001*f:B,d.x=e.x-G.x,d.y=e.y-G.y,d.length=Math.min(C,d.length),d}function n(b){for(var c=100*A,d=new Point,e=0,f=0,g=b.length;g>f;f++){var h=I[f];if(h>0&&c>h){var i=new Point(a.x-b[f].position().x,a.y-b[f].position().y);i.length=1/h,d.x+=i.x,d.y+=i.y,e++}}return e>0&&(d.x/=e,d.y/=e),d.isZero()||(d.length=B,d.x-=G.x,d.y-=G.y,d.length=Math.min(d.length,C)),d}function o(a){for(var b=25,c=new Point,d=0,e=0,f=a.length;f>e;e++){var g=I[e];g>0&&b>g&&(c.x+=a[e].vector().x,c.y+=a[e].vector().y,d++)}return d>0&&(c.x/=d,c.y/=d),c.isZero()||(c.length=B,c.x-=G.x,c.y-=G.y,c.length=Math.min(c.length,C)),c}function p(a){for(var b=1e4,c=new Point,d=0,e=0,f=a.length;f>e;e++){var g=I[e];g>0&&b>g&&(c.x+=a[e].position().x,c.y+=a[e].position().y,d++)}return d>0?(c.x/=d,c.y/=d,m(c,!1)):c}function q(a){return J=a||J}function r(){return F}function s(){return G}function t(b){return void 0!=b&&(a=new Point(b)),a}function u(){return A}function v(){return D}function w(){return E}function x(){return B}function y(){return C}var z=b.strength||.5*Math.random(),A=b.radius||30,B=b.maxSpeed+z||10+z,C=b.maxForce+z||.05+z,D=b.path||null,E=b.data||null,F=new Point,G=new Point.random(-B*C,B*C),a=new Point(a),H=0,I=[],J=!1,K=!1;
return{run:c,flock:d,update:f,updateItems:g,seek:h,arrive:i,borders:j,contain:k,repel:l,steer:m,separate:n,align:o,cohesion:p,groupTogether:q,acceleration:r,vector:s,position:t,radius:u,path:v,data:w,maxSpeed:x,maxForce:y}},predator:function(a,b){var c=new folio.FFlock.boid(a,b);return c.run=function(a,b){c.groupTogether()?c.align(a):c.flock(a),c.borders(),c.update(),c.updateItems(),c.repel(b)},c.repel=function(a){for(var d=0,e=a.length;e>d;d++)a[d].repel(c,b)},c},obstacle:function(a,b){var c=new folio.FFlock.boid(a,b);return c.run=function(a){c.repel(a)},c.repel=function(a){for(var d=0,e=a.length;e>d;d++)a[d].repel(c,b)},c}},folio.FNoise={perlin:function(a,b,c){var a=a||0,b=b||0,c=c||0,d=function(a){return a*a*a*(a*(6*a-15)+10)},e=function(a,b,c){return b+a*(c-b)},f=function(a,b,c,d){var e=15&a,f=8>e?b:c,g=4>e?c:12==e||14==e?b:d;return(0==(1&e)?f:-f)+(0==(2&e)?g:-g)},g=function(a){return(1+a)/2};return function(a,b,c){for(var h=new Array(512),i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],j=0;256>j;j++)h[256+j]=h[j]=i[j];var k=255&Math.floor(a),l=255&Math.floor(b),m=255&Math.floor(c);a-=Math.floor(a),b-=Math.floor(b),c-=Math.floor(c);var n=d(a),o=d(b),p=d(c),q=h[k]+l,r=h[q]+m,s=h[q+1]+m,t=h[k+1]+l,u=h[t]+m,v=h[t+1]+m;return g(e(p,e(o,e(n,f(h[r],a,b,c),f(h[u],a-1,b,c)),e(n,f(h[s],a,b-1,c),f(h[v],a-1,b-1,c))),e(o,e(n,f(h[r+1],a,b,c-1),f(h[u+1],a-1,b,c-1)),e(n,f(h[s+1],a,b-1,c-1),f(h[v+1],a-1,b-1,c-1)))))}}},folio.FRoute=function(a,b){var a=a,b=void 0!=b?b:1e3,c=0,d=[];return function(){var e,f;if(0===c){for(var g=0,h=[a.length],i=0;i<a.length;++i){h[i]=!1;var j=a[i].position.x,k=a[i].position.y;j>=view.bounds.width||k>=view.bounds.height||0>j||0>k||(h[i]=!0,g++)}d=[g];for(var l=0,i=0;i<a.length;++i)h[i]&&(d[l]=i,l++)}var m=d.length-1;if(c<d.length-2){var n=c+1e3;n>m&&(n=m);for(var i=c;n>i;++i){f=a[d[c]].position;for(var o=0,p=Number.MAX_VALUE,q=c+1;m>q;++q){var r=a[d[q]].position,s=f.x-r.x,t=f.y-r.y,u=s*s+t*t;p>u&&(o=q,p=u)}e=d[c+1],d[c+1]=d[o],d[o]=e,m>c?c++:console.log("Now optimizing plot path")}}for(var i=0;b>i;++i){var v=Math.floor(Math.random()*m),w=Math.floor(Math.random()*m);if(!(Math.abs(v-w)<2)){v>w&&(e=w,w=v,v=e);var x=a[d[v]].position,y=a[d[v+1]].position,z=a[d[w]].position,A=a[d[w+1]].position,s=x.x-y.x,t=x.y-y.y,u=s*s+t*t;s=z.x-A.x,t=z.y-A.y,u+=s*s+t*t,s=x.x-z.x,t=x.y-z.y;var B=s*s+t*t;if(s=y.x-A.x,t=y.y-A.y,B+=s*s+t*t,u>B)for(var C=w,D=v+1;C>D;)e=d[D],d[D]=d[C],d[C]=e,C--,D++}}}(),{route:d}},folio.FSkeleton=function(a){function b(){centerlinepath=new Path,centerlinepath.closed=!1;for(var b=0,c=a.segments.length;b!=c;b++){--c;var d,e,f=a.segments[b].point.x,g=a.segments[b].point.y,h=a.segments[c].point.x,i=a.segments[c].point.y;h==f?(d=f,e=i-(i-g)/2):g==i?(d=h-(h-f)/2,e=g):(d=h-(h-f)/2,e=i-(i-g)/2);var j=new Point(d,e);new Path.Circle({center:j,radius:6,strokeColor:new Color({hue:360/a.segments.length*b,saturation:.9,brightness:.9}),strokeWidth:3});var k=new Segment(j,a.curves[b].segment2.handleIn,a.curves[b].segment1.handleOut);centerlinepath.add(k)}return centerlinepath}var a=a;return{get:b}},String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},String.prototype.trimStart=function(){return this.replace(/^\s\s*/,"")},String.prototype.trimLeft||(String.prototype.trimLeft=String.prototype.trimStart),String.prototype.trimEnd=function(){return this.replace(/\s\s*$/,"")},String.prototype.trimRight||(String.prototype.trimRight=String.prototype.trimEnd),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")}),String.prototype.toBool=function(){switch(this.toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(this)}},String.prototype.reverse=function(){for(var a=this.split("\n"),b="",c=0;c<a.length;c++)a[c].trim(),b=a[c]+"\n"+b;return b},String.prototype.perLine=function(a,b){b=b||" ";for(var c=this.split(b),d="",e=1,f=0;f<c.length;f++)c[f].trim(),d=0===e%a&&1!==e?d+c[f]+"\n":d+c[f]+b,e++;return d},String.prototype.random=function(a){a=a||36;for(var b="";b.length<a;b+=Math.random().toString(36).substr(2));return b.substr(0,a)},folio.FTileEngine=function(a){function b(a){var b=a.getAttribute("data-sides"),c={id:a.id,width:a.getBBox().width,height:a.getBBox().height,data:b,top:[],right:[],bottom:[],left:[]};return c}function c(){for(var a in m)for(var b in m)("1"===m[a].data[0]&&"1"===m[b].data[2]||"0"===m[a].data[0]&&"0"===m[b].data[2])&&m[a].top.push(b),("1"===m[a].data[1]&&"1"===m[b].data[3]||"0"===m[a].data[1]&&"0"===m[b].data[3])&&m[a].right.push(b),("1"===m[a].data[2]&&"1"===m[b].data[0]||"0"===m[a].data[2]&&"0"===m[b].data[0])&&m[a].bottom.push(b),("1"===m[a].data[3]&&"1"===m[b].data[1]||"0"===m[a].data[3]&&"0"===m[b].data[1])&&m[a].left.push(b);return m}function d(a,b){var c=g();a=a||Math.ceil(view.bounds.width/c.width),b=b||Math.ceil(view.bounds.height/c.height),n=[];for(var d=[],e=0;b>e;e++){for(var f=0;a>f;f++)0===e?c=i(c,"right"):e>0&&f>0&&(c=k([{tile:c,side:"right"},{tile:n[e-1][f],side:"bottom"}])),d.push(c);n.push(d),d=[],c=i(n[e][f-a],"bottom")}return n}function e(a){for(var e,f=0;f<a.length;f++)e=a[f],m[e]=b(document.getElementById(a[f]));c(),d()}function f(a){return"string"==typeof a?m[a]:null}function g(){var a=Object.keys(m),b=a[Math.floor(a.length*Math.random())];return m[b]}function h(a,b){return a[b]}function i(a,b){var c=h(a,b),d=c[parseInt(Math.random()*c.length)];return m[d]}function j(a){if(a.length>=2){var b=a[0].tile[a[0].side].same(a[1].tile[a[1].side]);return b}return!1}function k(a){if(a.length>=2){var b=j(a),c=b[parseInt(Math.random()*b.length)];return f(b[c])}return!1}function l(){return n}var m={},n=[];return function(){void 0!==a&&e(a)}(),{tiles:m,createMap:d,set:e,get:f,getRandom:g,getNeighbor:h,getRandomNeighbor:i,getNeighborMultipleSides:j,getRandomNeighborMultipleSides:k,getMap:l}};var EPSILON=1e-6;folio.FTriangulate=function(a){function b(){if(k=[],null!=l.length){l=f(l),l.sort(e);var a=l[0].x,b=l[0].y,d=a,h=b;l[0].z;for(var i=0;i<l.length;i++){var j=l[i];j.x<a&&(a=j.x),j.x>d&&(d=j.x),j.y<b&&(b=j.y),j.y>h&&(h=j.y)}var p=d-a,q=h-b,r=p>q?p:q,s=(d+a)/2,t=(h+b)/2;k=[];var u=new HashSet,v=new n(new Point(s-2*r,t-r),new Point(s,t+2*r),new Point(s+2*r,t-r));k.push(v);for(var w=[],i=0;i<l.length;i++){var j=l[i];w=[];for(var x=new Point,y=k.length-1;y>=0;y--){var z=k[y];if(!u.contains(z)){var A=c(j,z,x);x.x+x.z<j.x&&u.add(z),A&&(w.push(new o(z.p1,z.p2)),w.push(new o(z.p2,z.p3)),w.push(new o(z.p3,z.p1)),k.splice(y,1))}}w=g(w);for(var y=0;y<w.length-1;y++)for(var B=w[y],C=y+1;C<w.length;C++){var D=w[C];B.p1==D.p2&&B.p2==D.p1&&(B.p1=null,B.p2=null,D.p1=null,D.p2=null),B.p1==D.p1&&B.p2==D.p2&&(B.p1=null,B.p2=null,D.p1=null,D.p2=null)}for(var y=0;y<w.length;y++){var E=w[y];if(null!=E.p1&&null!=E.p2){for(var C=0;C<m.length;C++)E.p1.name=E.p1==m[C]?"__new":null,E.p2.name=E.p2==m[C]?"__new":null,j.name=j==m[C]?"__new":null;k.push(new n(E.p1,E.p2,j))}}}for(var i=k.length-1;i>=0;i--){var z=k[i];z.sharesVertex(v)&&k.splice(i,1)}}}function c(a,b,c){var d,e,f,g,h,i,j,k,l,m;return Math.abs(b.p1.y-b.p2.y)<EPSILON&&Math.abs(b.p2.y-b.p3.y)<EPSILON?!1:(Math.abs(b.p2.y-b.p1.y)<EPSILON?(e=-(b.p3.x-b.p2.x)/(b.p3.y-b.p2.y),g=(b.p2.x+b.p3.x)/2,i=(b.p2.y+b.p3.y)/2,c.x=(b.p2.x+b.p1.x)/2,c.y=e*(c.x-g)+i):Math.abs(b.p3.y-b.p2.y)<EPSILON?(d=-(b.p2.x-b.p1.x)/(b.p2.y-b.p1.y),f=(b.p1.x+b.p2.x)/2,h=(b.p1.y+b.p2.y)/2,c.x=(b.p3.x+b.p2.x)/2,c.y=d*(c.x-f)+h):(d=-(b.p2.x-b.p1.x)/(b.p2.y-b.p1.y),e=-(b.p3.x-b.p2.x)/(b.p3.y-b.p2.y),f=(b.p1.x+b.p2.x)/2,g=(b.p2.x+b.p3.x)/2,h=(b.p1.y+b.p2.y)/2,i=(b.p2.y+b.p3.y)/2,c.x=(d*f-e*g+i-h)/(d-e),c.y=d*(c.x-f)+h),j=b.p2.x-c.x,k=b.p2.y-c.y,l=j*j+k*k,c.z=Math.sqrt(l),j=a.x-c.x,k=a.y-c.y,m=j*j+k*k,l>=m)}function d(a){for(var b,c=0;c<k.length;c++)for(var d=k[c],e=a.getCentroid.getDistance(d.getCentroid),f=0;f<k.length;f++){var g=k[f],h=a.getCentroid.getDistance(g.getCentroid);if(e>h){b=g;break}}return b}function e(a,b){return a.x<b.x?1:a.x>b.x?-1:0}function f(a){a.sort();for(var b=1;b<a.length;)a[b-1].x==a[b].x&&a[b-1].y==a[b].y?a.splice(b,1):b++;return a}function g(a){a.sort();for(var b=1;b<a.length;)a[b-1].p1==a[b].p1&&a[b-1].p2==a[b].p2||a[b-1].p1==a[b].p2&&a[b-1].p2==a[b].p2?a.splice(b,1):b++;return a}function h(a){m=[],a instanceof Array?(m=a,l=l.concat(a)):(m[0]=a,l.push(a)),l=f(l),b()}function i(a){return null!=a?k[a]:k}function j(a){return null!=a?l[a]:l}var k,l=a,m=[],n=function(a,b,c){function d(d){return a==d.p1||a==d.p2||a==d.p3||b==d.p1||b==d.p2||b==d.p3||c==d.p1||c==d.p2||c==d.p3}function e(){return new Point((j.x+k.x+l.x)/3,(j.y+k.y+l.y)/3)}function f(){var a=0;j.x<k.x&&j.x<l.x?a=j.x:k.x<j.x&&k.x<l.x?a=k.x:l.x<j.x&&l.x<k.x&&(a=l.x);var b=0;j.x>k.x&&j.x>l.x?b=j.x:k.x>j.x&&k.x>l.x?b=k.x:l.x>j.x&&l.x>k.x&&(b=l.x);var c=Math.abs(b-a);return c}function g(){var a=0;j.y<k.y&&j.y<l.y?a=j.y:k.y<j.y&&k.y<l.y?a=k.y:l.y<j.y&&l.y<k.y&&(a=l.y);var b=0;j.y>k.y&&j.y>l.y?b=j.y:k.y>j.y&&k.y>l.y?b=k.y:l.y>j.y&&l.y>k.y&&(b=l.y);var c=Math.abs(b-a);return c}function h(){var a=0;return a+=(j.x+l.x)*(l.y-j.y),a+=(k.x+j.x)*(j.y-k.y),a+=(l.x+k.x)*(k.y-l.y),a/2}function i(){var a=[j,k,l];return a}var j=a,k=b,l=c;return{p1:j,p2:k,p3:l,sharesVertex:d,getCentroid:e,getArea:h,getWidth:f,getHeight:g,getPoints:i}},o=function(a,b){function c(){var a=[d,e];return a}var d=a,e=b,f=d.getDistance(e);return{p1:d,p2:e,dist:f,getPoints:c}};return b(),{add:h,getTriangles:i,getPoints:j,getClosest:d}};var HashSet=function(){function a(a){var b=b,c=b.indexOf(a);-1==c&&b.push(a)}function b(a){return g[a]}function c(){return g.length}function d(a){var b=b,c=b.indexOf(a);-1!=c&&b.splice(c,1)}function e(a){for(var b=!1,c=0;c<g.length;c++)g[c]===a&&(b=!0);return b}function f(){return g.join(",")}var g=[];return{add:a,get:b,size:c,remove:d,contains:e,toString:f}},Matrix3D=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.n11=a||1,this.n12=b||0,this.n13=c||0,this.n14=d||0,this.n21=e||0,this.n22=f||1,this.n23=g||0,this.n24=h||0,this.n31=i||0,this.n32=j||0,this.n33=k||1,this.n34=l||0,this.n41=m||0,this.n42=n||0,this.n43=o||0,this.n44=p||1,this.clone=function(){return new Matrix3D(this.n11,this.n12,this.n13,this.n14,this.n21,this.n22,this.n23,this.n24,this.n31,this.n32,this.n33,this.n34,this.n41,this.n42,this.n43,this.n44)},this.concat=function(a){this.init({n11:this.n11*a.n11+this.n12*a.n21+this.n13*a.n31+this.n14*a.n41,n12:this.n11*a.n12+this.n12*a.n22+this.n13*a.n32+this.n14*a.n42,n13:this.n11*a.n13+this.n12*a.n23+this.n13*a.n33+this.n14*a.n43,n14:this.n11*a.n14+this.n12*a.n24+this.n13*a.n34+this.n14*a.n44,n21:this.n21*a.n11+this.n22*a.n21+this.n23*a.n31+this.n24*a.n41,n22:this.n21*a.n12+this.n22*a.n22+this.n23*a.n32+this.n24*a.n42,n23:this.n21*a.n13+this.n22*a.n23+this.n23*a.n33+this.n24*a.n43,n24:this.n21*a.n14+this.n22*a.n24+this.n23*a.n34+this.n24*a.n44,n31:this.n31*a.n11+this.n32*a.n21+this.n33*a.n31+this.n34*a.n41,n32:this.n31*a.n12+this.n32*a.n22+this.n33*a.n32+this.n34*a.n42,n33:this.n31*a.n13+this.n32*a.n23+this.n33*a.n33+this.n34*a.n43,n34:this.n31*a.n14+this.n32*a.n24+this.n33*a.n34+this.n34*a.n44,n41:this.n41*a.n11+this.n42*a.n21+this.n43*a.n31+this.n44*a.n41,n42:this.n41*a.n12+this.n42*a.n22+this.n43*a.n32+this.n44*a.n42,n43:this.n41*a.n13+this.n42*a.n23+this.n43*a.n33+this.n44*a.n43,n44:this.n41*a.n14+this.n42*a.n24+this.n43*a.n34+this.n44*a.n44})},this.init=function(a){for(var b in a)this[b]=a[b]},this.createBox=function(a,b,c,d,e,f,g,h,i){this.identity(),0!=d&&this.rotateX(d),0!=e&&this.rotateY(e),0!=f&&this.rotateZ(f),(1!=a||1!=b||1!=c)&&this.scale(a,b,c),(0!=g||0!=h||0!=i)&&this.translate(g,h,i)},this.identity=function(){this.init({n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1})},this.rotateX=function(a){var b=Math.sin(a),c=Math.cos(a);this.concat(new Matrix3D(1,0,0,0,0,c,-b,0,0,b,c,0,0,0,0,1))},this.rotateY=function(a){var b=Math.sin(a),c=Math.cos(a);this.concat(new Matrix3D(c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1))},this.rotateZ=function(a){var b=Math.sin(a),c=Math.cos(a);this.concat(new Matrix3D(c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1))},this.setRotateAxis=function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x(),g=a.y(),h=a.z(),i=e*f,j=e*g;this.concat(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1)},this.scale=function(a,b,c){this.concat(new Matrix3D(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1))},this.translate=function(a,b,c){this.n41+=a,this.n42+=b,this.n43+=c},this.transformPoint=function(a){return new Vertex3D(this.n11*a.x+this.n21*a.y+this.n31*a.z+this.n41,this.n12*a.x+this.n22*a.y+this.n32*a.z+this.n42,this.n13*a.x+this.n23*a.y+this.n33*a.z+this.n43)},this.transformArray=function(a){for(var b=[],c=a.length/3,d=0;c>d;d++){var e=3*d,f=a[e],g=a[e+1],h=a[e+2];b[e]=this.n11*f+this.n21*g+this.n31*h+this.n41,b[e+1]=this.n12*f+this.n22*g+this.n32*h+this.n42,b[e+2]=this.n13*f+this.n23*g+this.n33*h+this.n43}return b},this.getPosition=function(){return[this.n12,this.n13,this.n14]},this.setPosition=function(a){return this.n12=a.x,this.n13=a.y,this.n14=a.z,this},this.makeFrustum=function(a,b,c,d,e,f){var g=2*e/(b-a),h=2*e/(d-c),i=(b+a)/(b-a),j=(d+c)/(d-c),k=-(f+e)/(f-e),l=-2*f*e/(f-e);this.concat({n11:g,n12:0,n13:i,n14:0,n21:0,n22:h,n23:j,n24:0,n31:0,n32:0,n33:k,n34:l,n41:0,n42:0,n43:-1,n44:0})},this.makePerspective=function(a,b,c,d){var e=c*Math.tan(a*Math.PI/360),f=-e,g=f*b,h=e*b;this.makeFrustum(g,h,f,e,c,d)},this.makeOrtho=function(a,b,c,d,e,f){var g=b-a,h=c-d,i=f-e,j=(b+a)/g,k=(c+d)/h,l=(f+e)/i;this.concat({n11:2/g,n12:0,n13:0,n14:-j,n21:0,n22:2/h,n23:0,n24:-k,n31:0,n32:0,n33:-2/i,n34:-l,n41:0,n42:0,n43:0,n44:1})},this.toString=function(){return this.n11+","+this.n12+","+this.n13+","+this.n14+","+this.n21+","+this.n22+","+this.n23+","+this.n24+","+this.n31+","+this.n32+","+this.n33+","+this.n34+","+this.n41+","+this.n42+","+this.n43+","+this.n44}};folio.F3D={FScene3:{},FPoint3:{},FSize3:{},FPath3:function(){}},folio.F3D.FPath3=Path.extend({_class:"FPath3",_serializeFields:{segments:[],closed:!1,scene:null,matrix:null,size:null,position3:null,fpoints3:[],rotation:null,translation:null},initialize:function(a){this._closed=!1,this._segments=[],this._scene=a,this._matrix=new Matrix3D,this._size=new folio.F3D.FSize3,this._position3=new folio.F3D.FPoint3,this._fpoints3=[],this._rotation=new folio.F3D.FPoint3,this._translation=new folio.F3D.FPoint3,this.name="FPath3",Path.call(this),this._initialize()},setScene:function(a){this._scene=a;for(var b=0;b<this._fpoints3.length;b++)this._fpoints3[b].setup(this._scene)},add3:function(a){this._fpoints3[this._fpoints3.length]=a},translate:function(a,b,c){"number"==typeof a?(this._translation.x=a,this._translation.y=b,this._translation.z=c):"object"==typeof a?(this._translation.x=a.x,this._translation.y=a.y,this._translation.z=a.z):(this._translation.x=void 0!=a?a:0,this._translation.y=void 0!=b?b:0,this._translation.z=void 0!=c?c:0);for(var d=0;d<this._fpoints3.length;d++){var e=this._fpoints3[d];e.setX(e.x+this._translation.x),e.setY(e.y+this._translation.y),e.setZ(e.z+this._translation.z)}},rotateX:function(a){this._rotation.x=a},rotateY:function(a){this._rotation.y=a},rotateZ:function(a){this._rotation.z=a},get:function(){this._segments=[];for(var a=0;a<this._fpoints3.length;a++){var b=this._fpoints3[a];this.add(new Point(b.x2D(),b.y2D()))}return this}}),folio.F3D.FPath3.inject({statics:new function(){return{FBox:function(a,b,c){this._position3=void 0!=b?b:new folio.F3D.FPoint3(0,0,0),this._size=void 0!=c?c:new folio.F3D.FSize3(10,10,10);for(var d=[6],e=[new folio.F3D.FPoint3(-.5,-.5,-.5),new folio.F3D.FPoint3(.5,-.5,-.5),new folio.F3D.FPoint3(.5,.5,-.5),new folio.F3D.FPoint3(-.5,.5,-.5)],f=[new folio.F3D.FPoint3(-.5,-.5,.5),new folio.F3D.FPoint3(.5,-.5,.5),new folio.F3D.FPoint3(.5,-.5,-.5),new folio.F3D.FPoint3(-.5,-.5,-.5)],g=[new folio.F3D.FPoint3(-.5,.5,.5),new folio.F3D.FPoint3(.5,.5,.5),new folio.F3D.FPoint3(.5,.5,-.5),new folio.F3D.FPoint3(-.5,.5,-.5)],h=[new folio.F3D.FPoint3(-.5,-.5,-.5),new folio.F3D.FPoint3(-.5,-.5,.5),new folio.F3D.FPoint3(-.5,.5,.5),new folio.F3D.FPoint3(-.5,.5,-.5)],i=[new folio.F3D.FPoint3(.5,-.5,-.5),new folio.F3D.FPoint3(.5,-.5,.5),new folio.F3D.FPoint3(.5,.5,.5),new folio.F3D.FPoint3(.5,.5,-.5)],j=[new folio.F3D.FPoint3(-.5,-.5,.5),new folio.F3D.FPoint3(.5,-.5,.5),new folio.F3D.FPoint3(.5,.5,.5),new folio.F3D.FPoint3(-.5,.5,.5)],k=[["front",e],["top",f],["bottom",g],["left",h],["right",i],["back",j]],l=[],m=0;m<k.length;m++){d[m]=new folio.F3D.FPath3,d[m].name="Z-TOP",l=k[m][1];for(var n=0;n<l.length;n++)d[m].add3(new folio.F3D.FPoint3(l[n].x*this._size.width,l[n].y*this._size.height,l[n].z*this._size.depth));d[m].closed=!0,d[m].translate(b),a.addItem(d[m])}return new Group(d)},FSphere:function(a,b,c,d){this._position3=void 0!=b?b:new folio.F3D.FPoint3(0,0,0),this._size=void 0!=c?new folio.F3D.FSize3(c,c,c):new folio.F3D.FSize3(10,10,10);var e,f=.5;e=void 0!=d?d instanceof Array?d:[d,d]:[6,6];for(var g=[],h=0;h<=e[0];h++)for(var i=Math.PI*(-f+(h-1)/e[0]),j=Math.sin(i),k=Math.cos(i),l=Math.PI*(-f+h/e[0]),m=Math.sin(l),n=Math.cos(l),o=0;o<=e[1];o++){var p=2*Math.PI*((o-1)/e[1]),q=Math.cos(p),r=Math.sin(p);g.push(new folio.F3D.FPoint3(q*k,r*k,j)),g.push(new folio.F3D.FPoint3(q*n,r*n,m))}for(var s=[g.length-2],h=0;h<g.length-2;h++)s[h]=new folio.F3D.FPath3,s[h].name="face"+h,s[h].add3(new folio.F3D.FPoint3(g[h].x*.5*this._size.width,g[h].y*.5*this._size.height,g[h].z*.5*this._size.depth)),s[h].add3(new folio.F3D.FPoint3(g[h+1].x*.5*this._size.width,g[h+1].y*.5*this._size.height,g[h+1].z*.5*this._size.depth)),s[h].add3(new folio.F3D.FPoint3(g[h+2].x*.5*this._size.width,g[h+2].y*.5*this._size.height,g[h+2].z*.5*this._size.depth)),s[h].closed=!0,s[h].translate(b),a.addItem(s[h]);return new Group(s)}}}}),folio.F3D.FPoint3=this.FPoint3=function(a,b,c){var d=null,e=0,f=0,g=0,h=0,i=0;this.x=void 0!=a?a:0,this.y=void 0!=b?b:0,this.z=void 0!=c?c:0,this.setup=function(a){d=a;var b=d.setupPoint(this.x,this.y,this.z),c=3*b,j=2*b;e=c,f=c+1,g=c+2,h=j,i=j+1},this.random=function(a,b,c,d,e,f){return a=void 0!=a?a:0,b=void 0!=b?b:view.bounds.width,c=void 0!=c?c:0,d=void 0!=d?d:view.bounds.height,e=void 0!=e?c:0,f=void 0!=f?d:1e3,this.x=paper.random(a,b),this.y=paper.random(c,d),this.z=paper.random(e,f),new folio.F3D.FPoint3(this.x,this.y,this.z)},this.setX=function(a){null!=d&&(d.points3D[e]=a),this.x=a},this.setY=function(a){null!=d&&(d.points3D[f]=a),this.y=a},this.setZ=function(a){null!=d&&(d.points3D[g]=a),this.z=a},this.set=function(a,b,c){this.setX(a),this.setY(b),this.setZ(c)},this.get=function(){return new folio.F3D.FPoint3(this.x,this.y,this.z)},this.x2D=function(){return d.points2D[h]},this.y2D=function(){return d.points2D[i]},this.getSceneIndex=function(){return _sceneIndex},this.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},this.add=function(a,b,c){"number"==typeof a?(this.x+=a,this.y+=b,this.z+=c):"object"==typeof a&&(this.x+=a.x(),this.y+=a.y(),this.z+=a.z()),this.set(this.x,this.y,this.z)},this.sub=function(a,b,c){"number"==typeof a?(this.x-=a,this.y-=b,this.z-=c):"object"==typeof a&&(this.x-=a.x(),this.y-=a.y(),this.z-=a.z()),this.set(this.x,this.y,this.z)},this.scale=function(a){this.x*=a,this.y*=a,this.z*=a,this.set(this.x,this.y,this.z)},this.mult=function(a,b,c){"number"==typeof a?(this.x*=a,this.y*=b,this.z*=c):"object"==typeof a&&(this.x*=a.x(),this.y*=a.y(),this.z*=a.z()),this.set(this.x,this.y,this.z)},this.div=function(a,b,c){"number"==typeof a?(this.x/=a,this.y/=b,this.z/=c):"object"==typeof a&&(this.x/=a.x(),this.y/=a.y(),this.z/=a.z()),this.set(this.x,this.y,this.z)},this.getDistance=function(a){var b=this.x-a.x(),c=this.y-a.y(),d=this.z-a.z();return Math.sqrt(b*b+c*c+d*d)},this.angleBetween=function(a,b){var c=a.x()*b.x()+a.y()*b.y()+a.z()*b.z(),d=Math.sqrt(a.x()*a.x()+a.y()*a.y()+a.z()*a.z()),e=Math.sqrt(b.x()*b.x()+b.y()*b.y()+b.z()*b.z());return Math.acos(c/(d*e))},this.normalize=function(){var a=this.mag();0!=a&&1!=a&&this.div(a)},this.toString=function(){return"[ "+this.x+", "+this.y+", "+this.z+" ]"},this.array=function(){return[this.x,this.y,this.z]}},folio.F3D.FScene3D=this.FScene3D=function(){function a(a,b){return a.z<b.z?-1:a.z>b.z?1:0}var b="PERSPECTIVE",c=null,d=new folio.F3D.FSize3(0,0,0),e=1,f=new folio.F3D.FPoint3(0,0,0),g=0,h=null,i=null,j=null;this.bounds=new folio.F3D.FSize3(0,0,0),this.points3D=[],this.points2D=[],this._ortho=function(){c.makeOrtho(-d.height,d.height,d.height,-d.height,-d.height,d.height)},this._perspective=function(){c.makePerspective(50,.5*this.bounds.width/this.bounds.height,d.depth,2*this.bounds.depth)},this.setup=function(a,b,e,f){this.points3D=[],this.points2D=[],h=[],c=new Matrix3D,this.bounds.width=a||paper.view.bounds.width,this.bounds.height=b||paper.view.bounds.height,this.bounds.depth=e||1e3,d.width=.5*this.bounds.width,d.height=.5*this.bounds.height,d.depth=.5*this.bounds.depth,this.setMode(f),i=new Group,j=new Group},this.draw=function(){c.identity(),"ORTHO"==b?this._ortho():this._perspective(),c.scale(e,e,e),c.rotateX(f.x),c.rotateY(f.y),c.rotateZ(f.z),c.translate(0,0,this.bounds.depth);for(var k=c.transformArray(this.points3D),l=0;g>l;l++){var m=3*l,n=2*l,o=k[m],p=k[m+1],q=k[m+2],r=this.bounds.depth/(q+this.bounds.depth);this.points2D[n]=o*r+d.width,this.points2D[n+1]=p*r+d.height}for(var s=0,t=[],l=0;l<h.length;l++){var u=h[l],v=this.averageZ(k,s,s+3*u._fpoints3.length),w={index:l,z:v};t.push(w),s+=3*u._fpoints3.length-1}t.sort(a),i.removeChildren(),j.removeChildren();for(var l=0;l<t.length;l++){var x=h[t[l].index].get();"Z-TOP"==x.name?j.appendBottom(x):"Z-BOTTOM"==x.name?i.appendBottom(x):null!=x&&i.appendBottom(x)}return"ORTHO"==b&&(j.scale(200,i.position),i.scale(200,i.position)),new Group(i,j)},this.setupPoint=function(a,b,c){var d=g;return this.points2D[this.points2D.length]=0,this.points2D[this.points2D.length]=0,this.points3D[this.points3D.length]=a,this.points3D[this.points3D.length]=b,this.points3D[this.points3D.length]=c,g++,d},this.averageZ=function(a,b,c){for(var d=0,e=b;c>e;e+=2)d+=parseInt(a[e+2]);var f=(c-b)/3;return d/f},this.setMode=function(a){b=void 0!=a?a:"PERSPECTIVE"},this.addItem=function(a){if(a.length>0)for(var b=0;b<a.length;b++)h[h.length]=a[b],a[b].setScene(this);else h[h.length]=a,a.setScene(this)},this.rotateX=function(a){f.setX(a)},this.rotateY=function(a){f.setY(a)},this.rotateZ=function(a){f.setZ(a)},this.get=function(){return i},this.getBounds=function(){return[this.bounds.width,this.bounds.height,this.bounds.depth]},this.getMatrix=function(){return c},this.getFocalLength=function(){return this.bounds.depth},this.getScale=function(){return e}},folio.F3D.FSize3=this.FSize3=function(a,b,c){this.width=void 0!=a?a:0,this.height=void 0!=b?b:0,this.depth=void 0!=c?c:0,this.setWidth=function(a){this.width=a},this.setHeight=function(a){this.height=a},this.setDepth=function(a){this.depth=a},this.set=function(a,b,c){this.setWidth(a),this.setHeight(b),this.setDepth(c)},this.get=function(){return new folio.F3D.FSize3(this.width,this.height,this.depth)},this.random=function(a,b,c,d,e,f){return a=void 0!=a?a:0,b=void 0!=b?b:view.bounds.width,c=void 0!=c?c:0,d=void 0!=d?d:view.bounds.height,e=void 0!=e?e:0,f=void 0!=f?f:1e3,this.width=paper.random(a,b),this.height=paper.random(c,d),this.depth=paper.random(e,f),this},this.volume=function(){return this.width*this.height*this.depth}};